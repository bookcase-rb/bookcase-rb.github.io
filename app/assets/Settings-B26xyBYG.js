import{d as T,aQ as V,u as F,aR as I,aS as j,r as v,o as A,c as e,b as o,aT as M,a as p,F as N,aU as O,B as _,aV as P,aW as w,S as L,e as R,i as K}from"./index-DU3akae0.js";import{B as b,a as Q}from"./BasicTopBar-D8zmHch7.js";import{D as U}from"./DoubleDeckerContainer-DiWDSmCC.js";import{D as W}from"./DeckerLayout-BXm5ygsE.js";import{d as q}from"./vue-utils-C8Ubh6bB.js";import"./useTRouter-CQdtzKen.js";const z="_settings_u1gk8_1",E="_list_u1gk8_1",G="_catogory_u1gk8_6",H="_item_u1gk8_12",J="_label_u1gk8_23",X="_value_u1gk8_29",Y="_control_u1gk8_38",l={settings:z,list:E,catogory:G,item:H,label:J,value:X,control:Y};function S(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!K(i)}const le=T({name:"Settings",setup(){const{updateSettingMap:i}=V(),{t:a}=F({useScope:"global"}),m=I(),C=j(),g=v([]),r=v(),d=v(),k=()=>Promise.all(M.map(s=>p.settings.getSettingsByCategory(s))).then(s=>{g.value=s});A(()=>{k()});const y=s=>{const{key:n,value:c}=s;return p.settings.updateSettingByKey(n,c).then(()=>{m.success(a("pages.settings.decker.topbar.saveSuccess")),i(n,c)}).catch(()=>{m.error(a("pages.settings.decker.topbar.saveFailed")),k()})},D=s=>{let n,c;if(d.value===void 0||r.value===void 0)return s(),e(N,null,null);const t=d.value;return e(W,{topBar:e(b,{leftSlots:[e(_,{text:!0,onClick:s},S(n=a("common.cancel"))?n:{default:()=>[n]})],rightSlots:[e(_,{text:!0,type:"primary",onClick:()=>{const{key:u}=t,f=g.value[r.value],h=f.findIndex(x=>x.key===u);f.splice(h,1,t),g.value.splice(r.value,1,f),y(t).finally(()=>{d.value=void 0,r.value=void 0,s()})}},S(c=a("common.save"))?c:{default:()=>[c]})]},null)},{default:()=>[e("div",{class:l.control},[e("div",null,[a(t.label)]),O(t,u=>{t.value=u})])]})},B=s=>e(Q,{topBar:e(b,null,{default:()=>[e(L,{name:"setting"},null),R(" "),a("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[a("pages.settings.topbar.title")]),e("ul",{class:o(l.list)},[g.value.map((n,c)=>e("div",{class:o(l.catogory)},[n.filter(t=>!t.hidden).map(t=>e("li",{key:t.key,class:o(l.item),onClick:()=>{P(t)&&(r.value=c,d.value=q(t),s())}},[e("span",{class:o(l.label)},[a(t.label)]),e("span",{class:o(l.value)},[w(t,u=>{t.value=u,y(t)})])]))])),e("div",{class:o(l.catogory)},[e("li",{class:o(l.item),onClick:()=>{C.warning({title:a("pages.settings.clearData.confirmDialog.title"),content:a("pages.settings.clearData.confirmDialog.content"),positiveText:a("common.yes"),negativeText:a("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([p.book.clearAllBooks(),p.bookcase.clearAllBookcases()]).then(()=>{m.success(a("pages.settings.clearData.confirmDialog.clearFinished"))})}})}},[e("span",{class:o(l.label)},[a("pages.settings.clearData.label")]),e("span",{class:o(l.value)},null)])])])]});return()=>e(U,{class:o(l.settings),maskClosable:!1},{default:B,decker:D})}});export{le as default};
