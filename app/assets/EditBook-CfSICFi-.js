import{d as v,u as g,a as y,r as l,w as h,b as S,c as t,B as A,S as d,f as i,e as C}from"./index-C0851Mfg.js";import{u as D}from"./useTRouter-BRfUkbT8.js";import{B as F,s as I}from"./index-Bedp4tXh.js";import{a as w,B as E}from"./BasicTopBar-CJTS6Gwf.js";import{D as q}from"./DeleteConfirmButton-BC72I-d_.js";import{s as N}from"./utils-lnPlP4m8.js";import"./vue-utils-BEe-s5Fe.js";import"./InputGroup-B5p6F-ET.js";import"./Popover-CyWR8_ua.js";import"./get-hxwF2no4.js";import"./Image-BIv4KVVT.js";import"./create-D3Vn69pI.js";import"./FormItem-CO-DkIAt.js";import"./InputNumber-BbX0pnGm.js";import"./Popconfirm-DIPBfer2.js";const P={"edit-book":"_edit-book_166qk_1"},O=v({name:"EditBook",setup(){const{t:u}=g({useScope:"global"}),{route:p,router:f}=D(),{message:s}=y(),c=l(),n=l(),a=l(!1),k=o=>{a.value=!0,i.book.queryBookByBookId(o).then(e=>{e&&(n.value=e)}).finally(()=>{a.value=!1})},m=new AbortController;function b(o){a.value=!0;const e=m.signal;return(o?Promise.resolve(o):Promise.reject()).then(r=>I(r,e)).catch(r=>{throw r.name!=="AbortError"&&s.error(...N()),r}).finally(()=>{a.value=!1})}h(()=>p.params.bookId,o=>{Array.isArray(o)||k(o)},{immediate:!0});function B(){var o;(o=c.value)==null||o.getFormData().then(e=>{const r=e;i.book.updateBook(r).then(()=>{s.success(u("pages.book.edit.saveSuccess"))})})}return S(()=>{s.destroyAll(),m.abort()}),()=>t("div",{class:C(P["edit-book"])},[t(w,{loading:a.value,topBar:t(E,{rightSlots:[t(A,{onClick:B},{default:()=>[t(d,{name:"save"},null)]}),t(q,{onConfirm:()=>{var e;const o=(e=n.value)==null?void 0:e.id;o&&i.book.deleteBook(o).then(()=>{s.success(u("pages.book.edit.deleteSuccess")),f.back()})}},{default:()=>[t(d,{name:"delete"},null)]})]},{default:()=>{var o;return[((o=n.value)==null?void 0:o.title)||"-"]}})},{default:()=>[t(F,{ref:c,scraping:a.value,data:n.value,onScrape:b},null)]})])}});export{O as default};
//# sourceMappingURL=EditBook-CfSICFi-.js.map
