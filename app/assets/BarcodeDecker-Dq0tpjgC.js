import{B as M}from"./BasicTopBar-pM3hxXIp.js";import{a as I}from"./DeckerLayout-BGm3u6Rp.js";import{d as D,c as n,e as W,r as u,w as _,o as P,b as V,F as E,S as R}from"./index-B3qSu1dX.js";const O="_button_1nwl4_1",U="_circle_1nwl4_11",B={button:O,circle:U},F=D({name:"Button",props:{text:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},type:{type:String,default:"default"},onClick:{type:Function}},setup(e,{slots:t}){const r=c=>{var g;(g=e.onClick)==null||g.call(e,c)};return()=>{var c;return n("div",{class:W(B.button,B[e.type],{[B.circle]:e.circle}),onClick:r},[(c=t.default)==null?void 0:c.call(t)])}}});function z(e){return new Worker("/app/assets/barcodeRecognize.worker-BQ6b1ZBG.js",{name:e==null?void 0:e.name})}const G="_barcode_g8xn1_1",H={barcode:G},L={front:{facingMode:"user"},rear:{facingMode:"environment"}},N={},Q=D({name:"Barcode",props:{cameraType:{type:String,default:"rear"},onDevicesDetect:{type:Function},onBarcodeDetect:{type:Function}},setup(e){const t=u(),r=u(),c=u(!1),g=()=>navigator.mediaDevices.enumerateDevices().then(a=>{var o;console.log(a);const l=a.filter(s=>s.kind==="videoinput");return(o=e.onDevicesDetect)==null||o.call(e,l),l}),w=()=>{navigator.mediaDevices.getUserMedia({video:{...N,...L[e.cameraType]},audio:!1}).then(a=>{if(!t.value)return Promise.reject();r.value=a,t.value.srcObject=a,t.value.play(),t.value.onloadedmetadata=()=>{h()},a.getVideoTracks().forEach(o=>{console.log(o.getSettings())})}).catch(a=>{console.error("Error accessing the camera: "+a)})},b=()=>{r.value&&(r.value.getTracks().forEach(a=>{a.stop()}),r.value=void 0),t.value&&(t.value.pause(),t.value.srcObject=null),window.clearTimeout(y.value),y.value=void 0},d=u(null),h=()=>{if(!t.value)return Promise.reject();const a=t.value.videoWidth,l=t.value.videoHeight,o=new OffscreenCanvas(640,640);o.width=a,o.height=l;const s=o==null?void 0:o.getContext("2d");if(s==null||s.drawImage(t.value,0,0),a>0&&l>0&&s&&!c.value&&d.value){const T=s.getImageData(0,0,a,l);d.value.postMessage(T,[T.data.buffer]),d.value.onmessage=x=>{var S;const{output:$,corners:m,result:k}=x.data;k&&(j.value=k,c.value||(c.value=!0,(S=e.onBarcodeDetect)==null||S.call(e,k).then(f=>{c.value=f})));const v=C.value;v&&(v.width=a,v.height=l);const i=v==null?void 0:v.getContext("2d");if(i){i.strokeStyle="red",i.lineWidth=2,i.beginPath(),i.moveTo(m[0],m[1]);for(let f=2;f<m.length;f+=2)i.lineTo(m[f],m[f+1]);i.closePath(),i.stroke()}h()}}},y=u();_(()=>c.value,a=>{a||(y.value=window.setTimeout(()=>{h()},1e3))}),_(()=>e.cameraType,()=>{b(),w()});const j=u(""),C=u();return P(()=>{g().then(()=>{w()}),d.value=new z}),V(()=>{var a;(a=d.value)==null||a.terminate(),d.value=null,b()}),()=>n(E,null,[n("div",{class:W(H.barcode)},[n("video",{ref:t,playsinline:!0},null),n("canvas",{ref:C},null)])])}}),K=D({name:"BarcodeDecker",props:{onClose:{type:Function},onBarcodeDetect:{type:Function}},setup(e){const t=u("rear");return()=>n(I,{fullWidth:!0,style:{backgroundColor:"#000"},topBar:n(M,{leftSlots:[n(F,{circle:!0,onClick:()=>{var r;(r=e.onClose)==null||r.call(e)}},{default:()=>[n(R,{name:"close"},null)]})],rightSlots:[n(F,{circle:!0,onClick:()=>{t.value=t.value==="rear"?"front":"rear"}},{default:()=>[n(R,{name:"cameraSwitch"},null)]})]},null)},{default:()=>[n(Q,{cameraType:t.value,onBarcodeDetect:e.onBarcodeDetect},null)]})}});export{K as B};
//# sourceMappingURL=BarcodeDecker-Dq0tpjgC.js.map
