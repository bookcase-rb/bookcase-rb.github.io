import{L as W,b7 as j,s as J,w as O,b8 as q,b9 as X,d as N,t as Y,u as ee,r as w,c as d,S as P,e as z,g as te,F as Q,i as ne,f as se,o as ie,b as oe}from"./index-n8WRPimo.js";import{N as le,g as ae}from"./utils-Dk8xp9Lt.js";import{N as re}from"./Popconfirm-C4oU0iby.js";import{B as ce}from"./BasicTopBar-DKU1SHVf.js";import{a as ue}from"./DeckerLayout-DIaoEkOj.js";function E(s,a,e){let n=e.initialDeps??[],t;function i(){var l,o,r,h;let u;e.key&&((l=e.debug)!=null&&l.call(e))&&(u=Date.now());const x=s();if(!(x.length!==n.length||x.some((b,y)=>n[y]!==b)))return t;n=x;let v;if(e.key&&((o=e.debug)!=null&&o.call(e))&&(v=Date.now()),t=a(...x),e.key&&((r=e.debug)!=null&&r.call(e))){const b=Math.round((Date.now()-u)*100)/100,y=Math.round((Date.now()-v)*100)/100,I=y/16,C=(_,R)=>{for(_=String(_);_.length<R;)_=" "+_;return _};console.info(`%c⏱ ${C(y,5)} /${C(b,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*I,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(h=e==null?void 0:e.onChange)==null||h.call(e,t),t}return i.updateDeps=l=>{n=l},i}function V(s,a){if(s===void 0)throw new Error("Unexpected undefined");return s}const he=(s,a)=>Math.abs(s-a)<1,de=(s,a,e)=>{let n;return function(...t){s.clearTimeout(n),n=s.setTimeout(()=>a.apply(this,t),e)}},fe=s=>s,me=s=>{const a=Math.max(s.startIndex-s.overscan,0),e=Math.min(s.endIndex+s.overscan,s.count-1),n=[];for(let t=a;t<=e;t++)n.push(t);return n},ge=(s,a)=>{const e=s.scrollElement;if(!e)return;const n=s.targetWindow;if(!n)return;const t=l=>{const{width:o,height:r}=l;a({width:Math.round(o),height:Math.round(r)})};if(t(e.getBoundingClientRect()),!n.ResizeObserver)return()=>{};const i=new n.ResizeObserver(l=>{const o=()=>{const r=l[0];if(r!=null&&r.borderBoxSize){const h=r.borderBoxSize[0];if(h){t({width:h.inlineSize,height:h.blockSize});return}}t(e.getBoundingClientRect())};s.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()});return i.observe(e,{box:"border-box"}),()=>{i.unobserve(e)}},H={passive:!0},K=typeof window>"u"?!0:"onscrollend"in window,ve=(s,a)=>{const e=s.scrollElement;if(!e)return;const n=s.targetWindow;if(!n)return;let t=0;const i=s.options.useScrollendEvent&&K?()=>{}:de(n,()=>{a(t,!1)},s.options.isScrollingResetDelay),l=u=>()=>{const{horizontal:x,isRtl:c}=s.options;t=x?e.scrollLeft*(c&&-1||1):e.scrollTop,i(),a(t,u)},o=l(!0),r=l(!1);r(),e.addEventListener("scroll",o,H);const h=s.options.useScrollendEvent&&K;return h&&e.addEventListener("scrollend",r,H),()=>{e.removeEventListener("scroll",o),h&&e.removeEventListener("scrollend",r)}},be=(s,a,e)=>{if(a!=null&&a.borderBoxSize){const n=a.borderBoxSize[0];if(n)return Math.round(n[e.options.horizontal?"inlineSize":"blockSize"])}return Math.round(s.getBoundingClientRect()[e.options.horizontal?"width":"height"])},pe=(s,{adjustments:a=0,behavior:e},n)=>{var t,i;const l=s+a;(i=(t=n.scrollElement)==null?void 0:t.scrollTo)==null||i.call(t,{[n.options.horizontal?"left":"top"]:l,behavior:e})};class ye{constructor(a){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(t=>{t.forEach(i=>{const l=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var t;(t=n())==null||t.disconnect(),e=null},observe:t=>{var i;return(i=n())==null?void 0:i.observe(t,{box:"border-box"})},unobserve:t=>{var i;return(i=n())==null?void 0:i.unobserve(t)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{typeof t>"u"&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:fe,rangeExtractor:me,onChange:()=>{},measureElement:be,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var n,t;(t=(n=this.options).onChange)==null||t.call(n,this,e)},this.maybeNotify=E(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((e=this.scrollElement)==null?void 0:e.window)??null,this.elementsCache.forEach(t=>{this.observer.observe(t)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(t,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<t?"forward":"backward":null,this.scrollOffset=t,this.isScrolling=i,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,n)=>{const t=new Map,i=new Map;for(let l=n-1;l>=0;l--){const o=e[l];if(t.has(o.lane))continue;const r=i.get(o.lane);if(r==null||o.end>r.end?i.set(o.lane,o):o.end<r.end&&t.set(o.lane,!0),t.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((l,o)=>l.end===o.end?l.index-o.index:l.end-o.end)[0]:void 0},this.getMeasurementOptions=E(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,n,t,i,l)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:l}),{key:!1}),this.getMeasurements=E(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:i,enabled:l},o)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const r=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,r);for(let u=r;u<e;u++){const x=i(u),c=this.options.lanes===1?h[u-1]:this.getFurthestMeasurement(h,u),v=c?c.end+this.options.gap:n+t,b=o.get(x),y=typeof b=="number"?b:this.options.estimateSize(u),I=v+y,C=c?c.lane:u%this.options.lanes;h[u]={index:u,start:v,size:y,end:I,key:x,lane:C}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=E(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,n,t,i)=>this.range=e.length>0&&n>0?we({measurements:e,outerSize:n,scrollOffset:t,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=E(()=>{let e=null,n=null;const t=this.calculateRange();return t&&(e=t.startIndex,n=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,n]},(e,n,t,i,l)=>i===null||l===null?[]:e({startIndex:i,endIndex:l,overscan:n,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.indexFromElement(e),i=this.measurementsCache[t];if(!i)return;const l=i.key,o=this.elementsCache.get(l);o!==e&&(o&&this.observer.unobserve(o),this.observer.observe(e),this.elementsCache.set(l,e)),e.isConnected&&this.resizeItem(t,this.options.measureElement(e,n,this))},this.resizeItem=(e,n)=>{const t=this.measurementsCache[e];if(!t)return;const i=this.itemSizeCache.get(t.key)??t.size,l=n-i;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,l,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!1))},this.measureElement=e=>{if(!e){this.elementsCache.forEach((n,t)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(t))});return}this._measureElement(e,void 0)},this.getVirtualItems=E(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let i=0,l=e.length;i<l;i++){const o=e[i],r=n[o];t.push(r)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();if(n.length!==0)return V(n[Z(0,n.length-1,t=>V(n[t]).start,e)])},this.getOffsetForAlignment=(e,n,t=0)=>{const i=this.getSize(),l=this.getScrollOffset();n==="auto"&&(n=e>=l+i?"end":"start"),n==="center"?e+=(t-i)/2:n==="end"&&(e-=i);const o=this.options.horizontal?"scrollWidth":"scrollHeight",h=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[o]:this.scrollElement[o]:0)-i;return Math.max(Math.min(h,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=this.measurementsCache[e];if(!t)return;const i=this.getSize(),l=this.getScrollOffset();if(n==="auto")if(t.end>=l+i-this.options.scrollPaddingEnd)n="end";else if(t.start<=l+this.options.scrollPaddingStart)n="start";else return[l,n];const o=n==="end"?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,n,t.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const i=this.getOffsetForIndex(e,n);if(!i)return;const[l,o]=i;this._scrollToOffset(l,{adjustments:void 0,behavior:t}),t!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(e))){const[h]=V(this.getOffsetForIndex(e,o));he(h,this.getScrollOffset())||this.scrollToIndex(e,{align:o,behavior:t})}else this.scrollToIndex(e,{align:o,behavior:t})}))},this.scrollBy=(e,{behavior:n}={})=>{this.cancelScrollToIndex(),n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;if(n.length===0)t=this.options.paddingStart;else if(this.options.lanes===1)t=((e=n[n.length-1])==null?void 0:e.end)??0;else{const i=Array(this.options.lanes).fill(null);let l=n.length-1;for(;l>=0&&i.some(o=>o===null);){const o=n[l];i[o.lane]===null&&(i[o.lane]=o.end),l--}t=Math.max(...i.filter(o=>o!==null))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(a)}}const Z=(s,a,e,n)=>{for(;s<=a;){const t=(s+a)/2|0,i=e(t);if(i<n)s=t+1;else if(i>n)a=t-1;else return t}return s>0?s-1:0};function we({measurements:s,outerSize:a,scrollOffset:e,lanes:n}){const t=s.length-1,i=r=>s[r].start;if(s.length<=n)return{startIndex:0,endIndex:t};let l=Z(0,t,i,e),o=l;if(n===1)for(;o<t&&s[o].end<e+a;)o++;else if(n>1){const r=Array(n).fill(0);for(;o<t&&r.some(u=>u<e+a);){const u=s[o];r[u.lane]=u.end,o++}const h=Array(n).fill(e+a);for(;l>=0&&h.some(u=>u>=e);){const u=s[l];h[u.lane]=u.start,l--}l=Math.max(0,l-l%n),o=Math.min(t,o+(n-1-o%n))}return{startIndex:l,endIndex:o}}function xe(s){const a=new ye(j(s)),e=J(a),n=a._didMount();return O(()=>j(s).getScrollElement(),t=>{t&&a._willUpdate()},{immediate:!0}),O(()=>j(s),t=>{a.setOptions({...t,onChange:(i,l)=>{var o;q(e),(o=t.onChange)==null||o.call(t,i,l)}}),a._willUpdate(),q(e)},{immediate:!0}),X(n),e}function ke(s){return xe(W(()=>({observeElementRect:ge,observeElementOffset:ve,scrollToFn:pe,...j(s)})))}const Se="_book_7ibaz_1",ze="_mask_7ibaz_24",_e="_tools_7ibaz_36",Te="_tool_7ibaz_36",Ce="_picked_7ibaz_58",Ie="_info_7ibaz_65",Me="_cover_7ibaz_69",Ee="_abstract_7ibaz_79",Oe="_title_7ibaz_95",S={"book-list":"_book-list_7ibaz_1","virtual-list":"_virtual-list_7ibaz_10",book:Se,mask:ze,tools:_e,tool:Te,picked:Ce,info:Ie,cover:Me,abstract:Ee,"full-text":"_full-text_7ibaz_87",title:Oe};function Re(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!ne(s)}const He=N({name:"BookList",props:{data:{type:Array,default:()=>[]},onPreviewBook:{type:Function},onEditBook:{type:Function},onDeleteBook:{type:Function}},setup(s){const{data:a}=Y(s),{t:e}=ee({useScope:"global"}),n=w([]);O(()=>a.value,f=>{se.book.queryCoversById(f.map(m=>m.covers[0]||"")).then(m=>{n.value=m.map((g,k)=>ae(g==null?void 0:g.file,f[k].title))})},{immediate:!0});const t=w(),i=w(!1),l=w(),o=()=>{t.value=void 0,i.value=!1,window.clearTimeout(l.value),l.value=void 0,v.value=!1,c.value=[-999,-999]},r=f=>{var k,p;if(f.touches.length!==1||((p=(k=f.target)==null?void 0:k.dataset)==null?void 0:p.target)==="tools")return;(i.value||t.value!==void 0)&&o()},h=()=>{t.value===void 0&&i.value&&o()},u=()=>{h()},x=()=>{h()},c=w([-999,-999]),v=w(!1),b=[{name:"preview",icon:"👀️",cb:()=>{var f;if(t.value!==void 0){const m=a.value[t.value];(f=s.onPreviewBook)==null||f.call(s,m)}o()}},{name:"edit",icon:d(P,{name:"pencil"},null),cb:()=>{var f;if(t.value!==void 0){const m=a.value[t.value];(f=s.onEditBook)==null||f.call(s,m)}o()}},{name:"delete",icon:d(P,{name:"delete"},null),cb:f=>{const{x:m,y:g}=f;c.value=[m,g],v.value=!0}}],y=f=>{var D,B,F,T;const m=(B=(D=f.target)==null?void 0:D.dataset)==null?void 0:B.tool,g=b.find(A=>A.name===m);if(g){g.cb(f);return}const k=((T=(F=f.target)==null?void 0:F.dataset)==null?void 0:T.index)||"",p=Number.parseInt(k,10);Number.isNaN(p)||(t.value=p,i.value=!1)},I=w(null),C=W(()=>({count:a.value.length,getScrollElement:()=>I.value,estimateSize:()=>120,overscan:3,gap:16})),_=ke(C),R=W(()=>_.value.getVirtualItems()),M=W(()=>_.value.getTotalSize());return()=>{var m,g;let f;return d(Q,null,[d("div",{class:z(S["book-list"]),ref:I,onTouchstart:r,onTouchmove:h,onTouchend:u,onTouchcancel:x,onClick:y},[d("div",{class:z(S["virtual-list"]),style:{"--list-height":`${M.value}px`}},[R.value.map(k=>{var A,$;const{index:p,key:D,size:B,start:F}=k,T=a.value[p];return d("div",{class:z(S.book),key:String(D),style:{"--book-height":`${B}px`,"--book-start":`${F}px`}},[d("div",{class:z(S.mask,{[S.picked]:t.value===p}),"data-index":p},[d("div",{class:z(S.tools)},[b.map(U=>d("div",{class:z(S.tool),"data-target":"tools","data-tool":U.name},[U.icon]))])]),d("div",{class:z(S.info)},[d("div",{class:z(S.cover),style:{backgroundImage:`url(${n.value[p]})`}},null),d("div",{class:z(S.abstract)},[d("div",{class:z(S["full-text"],S.title)},[T.title]),d("div",{class:z(S["full-text"])},[T.authors?(A=T.authors)==null?void 0:A.join(" / "):e("pages.cell.bookList.unknownAuthor")]),d("div",{class:z(S["full-text"])},[T.publishers?($=T.publishers)==null?void 0:$.join(" / "):e("pages.cell.bookList.unknownPublisher")]),d("div",null,[te("isbn: "),T.isbn]),d(le,{count:5,value:T.rating,readonly:!0,size:"small"},null)])])])})])]),d(re,{showIcon:!1,placement:"left-end",trigger:"manual",positiveText:e("common.delete"),negativeText:e("common.forgetIt"),"positive-button-props":{type:"error"},onPositiveClick:()=>{var k;if(t.value!==void 0){const p=a.value[t.value];(k=s.onDeleteBook)==null||k.call(s,p)}o()},onNegativeClick:()=>{v.value=!1},onClickoutside:()=>{v.value=!1},x:(m=c.value)==null?void 0:m[0],y:(g=c.value)==null?void 0:g[1],show:v.value},Re(f=e("common.deleteConfirm"))?f:{default:()=>[f]})])}}}),De="_button_1nwl4_1",Be="_circle_1nwl4_11",L={button:De,circle:Be},G=N({name:"Button",props:{text:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},type:{type:String,default:"default"},onClick:{type:Function}},setup(s,{slots:a}){const e=n=>{var t;(t=s.onClick)==null||t.call(s,n)};return()=>{var n;return d("div",{class:z(L.button,L[s.type],{[L.circle]:s.circle}),onClick:e},[(n=a.default)==null?void 0:n.call(a)])}}});function Fe(s){return new Worker("/app/assets/barcodeRecognize.worker-BQ6b1ZBG.js",{name:s==null?void 0:s.name})}const Ae="_barcode_g8xn1_1",We={barcode:Ae},je={front:{facingMode:"user"},rear:{facingMode:"environment"}},Pe={},Ne=N({name:"Barcode",props:{cameraType:{type:String,default:"rear"},onDevicesDetect:{type:Function},onBarcodeDetect:{type:Function}},setup(s){const a=w(),e=w(),n=w(!1),t=()=>navigator.mediaDevices.enumerateDevices().then(c=>{var b;console.log(c);const v=c.filter(y=>y.kind==="videoinput");return(b=s.onDevicesDetect)==null||b.call(s,v),v}),i=()=>{navigator.mediaDevices.getUserMedia({video:{...Pe,...je[s.cameraType]},audio:!1}).then(c=>{if(!a.value)return Promise.reject();e.value=c,a.value.srcObject=c,a.value.play(),a.value.onloadedmetadata=()=>{r()},c.getVideoTracks().forEach(b=>{console.log(b.getSettings())})}).catch(c=>{console.error("Error accessing the camera: "+c)})},l=()=>{e.value&&(e.value.getTracks().forEach(c=>{c.stop()}),e.value=void 0),a.value&&(a.value.pause(),a.value.srcObject=null),window.clearTimeout(h.value),h.value=void 0},o=w(null),r=()=>{if(!a.value)return Promise.reject();const c=a.value.videoWidth,v=a.value.videoHeight,b=new OffscreenCanvas(640,640);b.width=c,b.height=v;const y=b==null?void 0:b.getContext("2d");if(y==null||y.drawImage(a.value,0,0),c>0&&v>0&&y&&!n.value&&o.value){const C=y.getImageData(0,0,c,v);o.value.postMessage(C,[C.data.buffer]),o.value.onmessage=_=>{var k;const{output:R,corners:M,result:f}=_.data;f&&(u.value=f,n.value||(n.value=!0,(k=s.onBarcodeDetect)==null||k.call(s,f).then(p=>{n.value=p})));const m=x.value;m&&(m.width=c,m.height=v);const g=m==null?void 0:m.getContext("2d");if(g){g.strokeStyle="red",g.lineWidth=2,g.beginPath(),g.moveTo(M[0],M[1]);for(let p=2;p<M.length;p+=2)g.lineTo(M[p],M[p+1]);g.closePath(),g.stroke()}r()}}},h=w();O(()=>n.value,c=>{c||(h.value=window.setTimeout(()=>{r()},1e3))}),O(()=>s.cameraType,()=>{l(),i()});const u=w(""),x=w();return ie(()=>{t().then(()=>{i()}),o.value=new Fe}),oe(()=>{var c;(c=o.value)==null||c.terminate(),o.value=null,l()}),()=>d(Q,null,[d("div",{class:z(We.barcode)},[d("video",{ref:a,playsinline:!0},null),d("canvas",{ref:x},null)])])}}),Ke=N({name:"BarcodeDecker",props:{onClose:{type:Function},onBarcodeDetect:{type:Function}},setup(s){const a=w("rear");return()=>d(ue,{fullWidth:!0,style:{backgroundColor:"#000"},topBar:d(ce,{leftSlots:[d(G,{circle:!0,onClick:()=>{var e;(e=s.onClose)==null||e.call(s)}},{default:()=>[d(P,{name:"close"},null)]})],rightSlots:[d(G,{circle:!0,onClick:()=>{a.value=a.value==="rear"?"front":"rear"}},{default:()=>[d(P,{name:"cameraSwitch"},null)]})]},null)},{default:()=>[d(Ne,{cameraType:a.value,onBarcodeDetect:s.onBarcodeDetect},null)]})}});export{Ke as B,He as a};
//# sourceMappingURL=BarcodeDecker-DdT5-JNj.js.map
