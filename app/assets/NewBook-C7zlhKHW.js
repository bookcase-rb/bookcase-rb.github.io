import{d as g,u as B,f as w,r as c,w as y,g as h,c as t,B as S,S as I,b as F,i as N,aa as _,ab as j,a as D}from"./index-ZpBZFUGP.js";import{B as R,s as q}from"./index-CjYNWCk4.js";import{a as C,B as E}from"./BasicTopBar-I_g2XRR_.js";import{s as O}from"./utils-B7WewF0G.js";import"./vue-utils-gz6nML3l.js";import"./InputGroup-D8CLqMua.js";import"./Popover-IqT3ki-t.js";import"./get-ahZrqNPx.js";import"./create-D3Vn69pI.js";import"./FormItem-D32qs1ac.js";import"./Image-CM07tQ5W.js";import"./InputNumber-ee3bOT0T.js";import"./useTRouter-BG6qXwJS.js";const V={"new-book":"_new-book_zpv31_1"};function x(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!N(a)}const W=g({name:"NewBook",setup(){const{t:a}=B({useScope:"global"}),i=_(),f=j(),{message:l}=w(),u=c(),s=c();function b(){var r;const{cellId:o,bookcaseId:e}=i.query;(r=u.value)==null||r.getFormData().then(m=>{console.log(m);const d=m;if(d){if(typeof o!="string"||typeof e!="string")throw new Error("cellId and bookcaseId invalid");D.book.addBook(d,o,e).then(k=>{const{id:v}=k;f.replace({path:`/book/preview/id/${v}`})})}})}const n=c(!1);function p(o){return n.value=!0,q(o).catch(e=>{throw l.error(...O(o)),e}).finally(()=>{n.value=!1})}return y(()=>i.query,o=>{const e=o.isbn;e&&p(e).then(r=>{s.value={...r}}).catch(()=>{s.value={isbn:e}})},{immediate:!0}),h(()=>{l.destroyAll()}),()=>{let o;return t("div",{class:F(V["new-book"])},[t(C,{topBar:t(E,{rightSlots:[t(S,{onClick:b},{default:()=>[t(I,{name:"save"},null)]})]},x(o=a("pages.book.new.topbar.title"))?o:{default:()=>[o]})},{default:()=>[t(R,{ref:u,scraping:n.value,data:s.value,onScrape:p},null)]})])}}});export{W as default};
