import{d as x,t as F,u as I,a as N,r,w as B,c as o,e as k,B as L,g as P,S as b,f as g,o as $,i as j,I as E}from"./index-B6wo-CfO.js";import{u as S}from"./useTRouter-dMPEWueJ.js";import{B as M,a as V}from"./BasicTopBar-CCdy-Rp6.js";import{E as A}from"./Empty-0oNtKqhX.js";import{d as O}from"./vue-utils-D04Zu4M5.js";import{D as W}from"./DeleteConfirmButton-D50TlYUg.js";import{B as q}from"./BookcasePreview-DjuElWh8.js";import"./Popconfirm-DiCRYgpg.js";import"./Popover-DYnvKjhe.js";import"./get-PenFHmx_.js";import"./constants-V-ZPE83q.js";const z="_waterfall_1mpvx_1",Y="_mask_1mpvx_28",G="_shown_1mpvx_45",d={waterfall:z,"bookcase-waterfall-list":"_bookcase-waterfall-list_1mpvx_11","waterfall-item":"_waterfall-item_1mpvx_20",mask:Y,shown:G},J=x({name:"WaterfallList",props:{list:{type:Array,default:()=>[]},onReloadData:{type:Function}},setup(l){const{list:i}=F(l),{t:u}=I({useScope:"global"}),{router:f}=S(),{message:h}=N(),n=r(),c=r(!1),y=r(0),p=r([]),_=r([]);B(i,t=>{p.value=Array(t.length).fill(void 0)},{immediate:!0}),B(p,t=>{if(t.filter(e=>e===void 0).length!==i.value.length){c.value=!0;const e=[],a=[0,0];for(let s=0;s<t.length;s++)a[0]<=a[1]?(e.push([0,a[0]]),a[0]+=t[s]):(e.push([1,a[1]]),a[1]+=t[s]);_.value=e,y.value=Math.max(...a)}},{immediate:!0});const C=t=>{var s;t.stopPropagation();const e=t.target,a=(s=e==null?void 0:e.dataset)==null?void 0:s.id;a!==void 0?n.value=a:n.value=void 0},R=t=>{var a;const e=(a=i.value[t])==null?void 0:a.id;e&&g.book.queryBookByBookcaseId(e).then(s=>{s!=null&&s.length?h.error(u("pages.bookcase.list.waterfallList.cannotDelete.message")):g.bookcase.deleteBookcase(e).then(()=>{var m;(m=l.onReloadData)==null||m.call(l),n.value=void 0})})};return()=>o("div",{class:k(d.waterfall),onClick:()=>{n.value=void 0}},[o("ul",{class:k(d["bookcase-waterfall-list"]),style:{height:`${y.value+1}px`},onClick:C},[i.value.map((t,e)=>{const a=_.value[e]||[0,(Math.random()-.5)*1e3],s=a[0]===0?"0%":"100%",m=a[1]+"px";return o("li",{key:t.id,class:k(d["waterfall-item"]),style:{visibility:c.value?"visible":"hidden",transform:`translate(${s}, ${m})`},"data-id":t.id},[o("div",{class:k(d.mask,{[d.shown]:n.value===t.id})},[o(L,{circle:!0,onClick:()=>{f.push({path:`/bookcase/edit/${t.id}`})}},{default:()=>[P("ðŸ‘€ï¸")]}),o(W,{circle:!0,onShow:w=>{w.stopPropagation()},onConfirm:()=>R(e)},{default:()=>[o(b,{name:"delete"},null)]})]),o(q,{bookcaseId:t.id,onSizeLoad:(w,T)=>{const v=O(p.value);v[e]===void 0&&(v[e]=T,p.value=[...v])}},null)])})])])}});function D(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!j(l)}const le=x({name:"ListBookcase",setup(){const{t:l}=I({useScope:"global"}),{router:i}=S(),u=r([]);function f(){g.bookcase.getBookcases().then(n=>{u.value=n})}$(()=>{f()});const h=()=>u.value.length===0?o(A,{title:l("pages.bookcase.list.empty.title"),description:o(E,{scope:"global",keypath:"pages.bookcase.list.empty.description"},{default:()=>[o(b,{name:"plus"},null)]})},null):o(J,{list:u.value,onReloadData:f},null);return()=>{let n,c;return o(V,{topBar:o(M,{rightSlots:[o(L,{onClick:()=>{i.push({path:"/bookcase/new"})}},{default:()=>[o(b,{name:"plus"},null)]})]},D(n=l("pages.bookcase.list.topbar.title"))?n:{default:()=>[n]})},D(c=h())?c:{default:()=>[c]})}}});export{le as default};
//# sourceMappingURL=ListBookcase-B919uhEl.js.map
