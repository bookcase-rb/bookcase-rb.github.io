import{u as z}from"./useTRouter-D4zg8088.js";import{d as y,t as F,u as _,c as e,a as V,s as j,r as B,o as T,b as q,e as b,B as k,S as v,i as O,f as P}from"./index-B3qSu1dX.js";import{B as R,E as D}from"./BookcaseNameInput-Bc3_XngR.js";import{d as p,a as E}from"./utils-7_mGPhvC.js";import{N as C,a as M}from"./FormItem-CDLaxtsf.js";import{N}from"./InputNumber-Dutkkz1c.js";import{B as U,a as A}from"./BasicTopBar-pM3hxXIp.js";import"./get-DrtZLwal.js";const L=y({name:"InitForm",props:{size:{type:Object,default:{width:p,height:p}},onChange:{type:Function}},setup(t){var i;const{size:n}=F(t),{t:c}=_({useScope:"global"});(i=t.onChange)==null||i.call(t,n.value);function r(o,s){var d;o!==null&&(n.value[s]=o,(d=t.onChange)==null||d.call(t,n.value))}return()=>e(M,{style:{marginTop:"24px"},inline:!0,labelPlacement:"left",model:n.value},{default:()=>[e(C,{label:c("common.width"),path:"width"},{default:()=>{var o;return[e(N,{placeholder:c("common.width"),buttonPlacement:"both",min:1,max:20,value:(o=n.value)==null?void 0:o.width,onUpdateValue:s=>r(s,"width")},null)]}}),e(C,{label:c("common.height"),path:"height"},{default:()=>{var o;return[e(N,{placeholder:c("common.height"),buttonPlacement:"both",min:1,max:20,value:(o=n.value)==null?void 0:o.height,onUpdateValue:s=>r(s,"height")},null)]}})]})}}),G="_title_1uqxc_6",H="_blur_1uqxc_13",u={"new-bookcase":"_new-bookcase_1uqxc_1",title:G,blur:H};function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!O(t)}const te=y({name:"BookcaseNew",setup(){const{t}=_({useScope:"global"}),{router:n}=z(),{message:c,dialog:r}=V("top"),i=j(),o=B(""),s=B(),d=()=>{const{width:a=p,height:l=p}=s.value||{},w={...E,width:a,height:l},f=[];for(let h=0;h<a;h++)for(let g=0;g<l;g++)f.push({from:[h,g],to:[h+1,g+1],merge:!1});i.value={meta:w,cells:f}};T(()=>{r.create({title:t("pages.bookcase.newBookcase.initDialog.title"),closable:!1,maskClosable:!1,closeOnEsc:!1,content:()=>e(L,{size:s.value,onChange:a=>{s.value=a}},null),positiveText:t("common.confirm"),negativeText:t("common.forgetIt"),onPositiveClick(){d()},onNegativeClick(){n.back()}})}),q(()=>{r.destroyAll()});const m=B(),S=()=>{var a;(a=m.value)==null||a.mergeCells().catch(()=>{c.error("merge failed")})},x=()=>{var a;(a=m.value)==null||a.breakCell()},I=()=>{var a;if(!o.value){c.error(t("pages.bookcase.newBookcase.bookcaseName.required"));return}(a=m.value)==null||a.getData().then(l=>{const w=l.bookcase,f=l.thumbnailFile;P.bookcase.createNewBookcase({...w,name:o.value},f).then(()=>{n.back()})})};return()=>{let a;return e(A,{topBar:e(U,{rightSlots:[e(k,{onClick:I},{default:()=>[e(v,{name:"save"},null)]})]},J(a=t("pages.bookcase.newBookcase.topbar.title"))?a:{default:()=>[a]}),toolBar:[e(k,{class:b(u.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:()=>{var l;(l=m.value)==null||l.resetView()}},{default:()=>[e(v,{name:"restore"},null)]}),e(k,{class:b(u.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:S},{default:()=>[e(v,{name:"mergeCells"},null)]}),e(k,{class:b(u.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:x},{default:()=>[e(v,{name:"breakCells"},null)]})]},{default:()=>[e("div",{class:b(u["new-bookcase"])},[e("div",{class:b(u.title,u.blur)},[e(R,{isDual:"editonly",value:o.value,onChange:l=>{o.value=l}},null)]),e(D,{ref:m,data:i.value},null)])]})}}});export{te as default};
//# sourceMappingURL=NewBookcase-iwjOWXWm.js.map
