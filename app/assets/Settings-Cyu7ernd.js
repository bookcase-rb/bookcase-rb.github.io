import{d as T,aQ as V,u as A,aR as F,aS as I,r as f,o as j,c as e,b as o,aT as M,a as g,F as N,aU as O,B as _,aV as P,aW as w,S as L,e as R,i as K}from"./index-DhaXtIy0.js";import{B as S,a as Q}from"./BasicTopBar-BLRqXlhH.js";import{D as U,a as W}from"./DeckerLayout-DzE9A4ps.js";import{d as q}from"./vue-utils-BoE53MNa.js";import"./useTRouter-BuFIPyyD.js";const z="_settings_u1gk8_1",E="_list_u1gk8_1",G="_catogory_u1gk8_6",H="_item_u1gk8_12",J="_label_u1gk8_23",X="_value_u1gk8_29",Y="_control_u1gk8_38",l={settings:z,list:E,catogory:G,item:H,label:J,value:X,control:Y};function b(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!K(i)}const se=T({name:"Settings",setup(){const{updateSettingMap:i}=V(),{t:a}=A({useScope:"global"}),m=F(),C=I(),d=f([]),r=f(),p=f(),k=()=>Promise.all(M.map(s=>g.settings.getSettingsByCategory(s))).then(s=>{d.value=s});j(()=>{k()});const y=s=>{const{key:n,value:c}=s;return g.settings.updateSettingByKey(n,c).then(()=>{m.success(a("pages.settings.decker.topbar.saveSuccess")),i(n,c)}).catch(()=>{m.error(a("pages.settings.decker.topbar.saveFailed")),k()})},D=s=>{let n,c;if(p.value===void 0||r.value===void 0)return s(),e(N,null,null);const t=p.value;return e(W,{topBar:e(S,{leftSlots:[e(_,{text:!0,onClick:s},b(n=a("common.cancel"))?n:{default:()=>[n]})],rightSlots:[e(_,{text:!0,type:"primary",onClick:()=>{const{key:u}=t,v=d.value[r.value],h=v.findIndex(x=>x.key===u);v.splice(h,1,t),d.value.splice(r.value,1,v),y(t).finally(()=>{p.value=void 0,r.value=void 0,s()})}},b(c=a("common.save"))?c:{default:()=>[c]})]},null)},{default:()=>[e("div",{class:l.control},[e("div",null,[a(t.label)]),O(t,u=>{t.value=u})])]})},B=s=>e(Q,{topBar:e(S,null,{default:()=>[e(L,{name:"setting"},null),R(" "),a("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[a("pages.settings.topbar.title")]),e("ul",{class:o(l.list)},[d.value.map((n,c)=>e("div",{class:o(l.catogory)},[n.filter(t=>!t.hidden).map(t=>e("li",{key:t.key,class:o(l.item),onClick:()=>{P(t)&&(r.value=c,p.value=q(t),s())}},[e("span",{class:o(l.label)},[a(t.label)]),e("span",{class:o(l.value)},[w(t,u=>{t.value=u,y(t)})])]))])),e("div",{class:o(l.catogory)},[e("li",{class:o(l.item),onClick:()=>{C.warning({title:a("pages.settings.clearData.confirmDialog.title"),content:a("pages.settings.clearData.confirmDialog.content"),positiveText:a("common.yes"),negativeText:a("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([g.book.clearAllBooks(),g.bookcase.clearAllBookcases(),g.settings.clearAllSettings()]).then(()=>{m.success(a("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:o(l.label)},[a("pages.settings.clearData.label")]),e("span",{class:o(l.value)},null)])])])]});return()=>e(U,{class:o(l.settings),maskClosable:!1},{default:B,decker:D})}});export{se as default};
//# sourceMappingURL=Settings-Cyu7ernd.js.map
