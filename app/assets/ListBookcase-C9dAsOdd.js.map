{"version":3,"file":"ListBookcase-C9dAsOdd.js","sources":["../../src/pages/bookcase/list/WaterfallList.tsx","../../src/pages/bookcase/list/ListBookcase.tsx"],"sourcesContent":["/**\n * @file ÁÄëÂ∏ÉÊµÅÂàóË°®\n * @author Yangholmes 2025-05-08\n */\n\nimport { defineComponent, PropType, ref, toRefs, watch } from 'vue';\nimport cn from 'classnames';\n\nimport useTRouter from '@/composite/useTRouter';\n\nimport { Bookcase } from '../utils';\nimport db from '@/services/db';\n\nimport DeleteConfirmButton from '@/components/deleteConfirmButton/DeleteConfirmButton';\nimport SvgIcon from '@/components/svgIcon/SvgIcon';\nimport BookcasePreview from '../bookcasePreview/BookcasePreview';\n\nimport { NButton } from 'naive-ui';\n\nimport styles from './waterfallList.module.less';\n\nexport default defineComponent({\n  name: 'WaterfallList',\n  props: {\n    list: {\n      type: Array as PropType<Pick<Bookcase, 'id' | 'name'>[]>,\n      default: () => []\n    },\n    onReloadData: {\n      type: Function as PropType<() => void>\n    }\n  },\n  setup(props) {\n    const { list } = toRefs(props);\n\n    const { router } = useTRouter();\n\n    const pickedItemId = ref<string>();\n\n    const isLoaded = ref<boolean>(false);\n    const totalHeight = ref(0);\n    const heights = ref<number[]>([]);\n    const positions = ref<[number, number][]>([]);\n\n    watch(heights.value, (newH) => {\n      if (newH.filter(item => item !== undefined).length === list.value.length) {\n        isLoaded.value = true;\n        const p: [number, number][] = [];\n        const maxY = [0, 0];\n        for (let i = 0; i < newH.length; i++) {\n          if (maxY[0] <= maxY[1]) {\n            p.push([0, maxY[0]]);\n            maxY[0] += newH[i];\n          } else {\n            p.push([1, maxY[1]]);\n            maxY[1] += newH[i];\n          }\n        }\n        positions.value = p;\n        totalHeight.value = Math.max(...maxY);\n      }\n    }, { immediate: true });\n\n    const onPick = (e: MouseEvent) => {\n      e.stopPropagation();\n      const target = e.target as HTMLElement;\n      const id = target?.dataset?.id;\n      if (id !== undefined) {\n        pickedItemId.value = id;\n      } else {\n        pickedItemId.value = undefined;\n      }\n    };\n\n    return () => <div\n      class={cn(styles.waterfall)}\n      onClick={() => {\n        pickedItemId.value = undefined;\n      }}\n    >\n      <ul\n        class={cn(styles['bookcase-waterfall-list'])}\n        style={{ height: `${totalHeight.value + 1}px` }}\n        onClick={onPick}\n      >\n        {list.value.map((item, index) => {\n          const position = positions.value[index] || [0, (Math.random() - 0.5) * 1e3];\n          const x = position[0] === 0 ? '0%' : '100%';\n          const y = position[1] + 'px';\n          return <li\n            key={item.id}\n            class={cn(styles['waterfall-item'])}\n            style={{\n              visibility: isLoaded.value ? 'visible' : 'hidden',\n              transform: `translate(${x}, ${y})`\n            }}\n            data-id={item.id}\n          >\n            <div\n              class={cn(styles.mask, {\n                [styles.shown]: pickedItemId.value === item.id\n              })}\n            >\n              <NButton circle onClick={() => {\n                router.push({\n                  path: `/bookcase/edit/${item.id}`,\n                });\n              }}>\n                üëÄÔ∏è\n              </NButton>\n              <DeleteConfirmButton\n                circle\n                onShow={(e) => {\n                  e.stopPropagation();\n                }}\n                onConfirm={() => {\n                  db.bookcase.deleteBookcase(item.id!).then(() => {\n                    props.onReloadData?.();\n                    pickedItemId.value = undefined;\n                  });\n                }}\n              >\n                <SvgIcon name=\"delete\" />\n              </DeleteConfirmButton>\n            </div>\n            <BookcasePreview\n              bookcaseId={item.id}\n              onSizeLoad={(_, height) => {\n                heights.value[index] = height;\n              }}\n            />\n          </li>;\n        })}\n      </ul>\n    </div>;\n  }\n});\n\n","/**\n * @file ‰π¶Êû∂ÂàóË°®\n * @author Yangholmes 2024-12-23\n */\n\nimport { defineComponent, onMounted, ref } from 'vue';\nimport { I18nT, useI18n } from 'vue-i18n';\nimport useTRouter from '@/composite/useTRouter';\n\nimport db from '@/services/db';\n\nimport BasicLayout from '@/pages/layout/BasicLayout';\nimport BasicTopBar from '@/pages/layout/BasicTopBar';\nimport Empty from '@/components/empty/Empty';\nimport SvgIcon from '@/components/svgIcon/SvgIcon';\n\nimport { NButton } from 'naive-ui';\n\nimport { Bookcase } from '../utils';\n\nimport WaterfallList from './WaterfallList';\n\nexport default defineComponent({\n  name: 'ListBookcase',\n  setup() {\n    const { t } = useI18n({ useScope: 'global' });\n    const { router } = useTRouter();\n\n    const list = ref<Pick<Bookcase, 'id' | 'name'>[]>([]);\n\n    function initData() {\n      db.bookcase.getBookcases().then(res => {\n        list.value = res;\n      });\n    }\n\n    // Ëé∑Âèñ‰π¶Êû∂ÂàóË°®\n    onMounted(() => {\n      initData();\n    });\n\n    const renderBookcaseList = () => {\n      if (list.value.length === 0) {\n        return (\n          <Empty\n            title={t('pages.bookcase.list.empty.title')}\n            description={\n              <I18nT scope=\"global\" keypath=\"pages.bookcase.list.empty.description\">\n                <SvgIcon name=\"plus\" />\n              </I18nT>\n            }\n          />\n        );\n      } else {\n        return <WaterfallList\n          list={list.value}\n          onReloadData={initData}\n        />;\n      }\n    };\n\n    return () => (\n      <BasicLayout\n        topBar={\n          <BasicTopBar rightSlots={[\n            <NButton onClick={() => {\n              router.push({\n                path: '/bookcase/new',\n              });\n            }\n            }>\n              <SvgIcon name=\"plus\" />\n            </NButton>\n          ]}>\n            {t('pages.bookcase.list.topbar.title')}\n          </BasicTopBar>\n        }\n      >\n        {renderBookcaseList()}\n      </BasicLayout>\n    );\n  }\n});\n"],"names":["defineComponent","name","props","list","type","Array","default","onReloadData","Function","setup","toRefs","router","useTRouter","pickedItemId","ref","isLoaded","totalHeight","heights","positions","watch","value","newH","filter","item","undefined","length","p","maxY","i","push","Math","max","immediate","onPick","e","stopPropagation","target","id","dataset","_createVNode","cn","styles","waterfall","onClick","height","map","index","position","random","x","y","visibility","transform","mask","shown","NButton","path","_createTextVNode","DeleteConfirmButton","onConfirm","db","bookcase","deleteBookcase","then","SvgIcon","BookcasePreview","onSizeLoad","_","_isSlot","s","Object","prototype","toString","call","_isVNode","t","useI18n","useScope","initData","getBookcases","res","onMounted","renderBookcaseList","Empty","I18nT","WaterfallList","_slot","_slot2","BasicLayout","BasicTopBar"],"mappings":"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"}