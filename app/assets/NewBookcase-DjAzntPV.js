import{u as z}from"./useTRouter-FMbDqIRO.js";import{d as N,t as F,u as y,c as e,f as j,s as T,r as C,o as q,g as O,b as f,B as h,S as k,i as P,a as R}from"./index-CsFALGSm.js";import{B as V,E as D}from"./BookcaseNameInput-oVX3ZkFp.js";import{d as v,a as E}from"./constants-CQIc40eP.js";import{N as w,a as M}from"./FormItem-Duhx32EN.js";import{N as B}from"./InputNumber-DwF8QQIP.js";import{B as A,a as L}from"./BasicTopBar-Ct7qZIyK.js";import"./get-ChfXJk72.js";const U=N({name:"InitForm",props:{size:{type:Object,default:{width:v,height:v}},onChange:{type:Function}},setup(t){var i;const{size:n}=F(t),{t:c}=y({useScope:"global"});(i=t.onChange)==null||i.call(t,n.value);function u(o,s){var g;o!==null&&(n.value[s]=o,(g=t.onChange)==null||g.call(t,n.value))}return()=>e(M,{style:{marginTop:"24px"},inline:!0,labelPlacement:"left",model:n.value},{default:()=>[e(w,{label:c("common.width"),path:"width"},{default:()=>{var o;return[e(B,{placeholder:c("common.width"),buttonPlacement:"both",min:1,max:20,value:(o=n.value)==null?void 0:o.width,onChange:s=>u(s,"width")},null)]}}),e(w,{label:c("common.height"),path:"height"},{default:()=>{var o;return[e(B,{placeholder:c("common.height"),buttonPlacement:"both",min:1,max:20,value:(o=n.value)==null?void 0:o.height,onChange:s=>u(s,"height")},null)]}})]})}}),G="_title_1uqxc_6",H="_blur_1uqxc_13",r={"new-bookcase":"_new-bookcase_1uqxc_1",title:G,blur:H};function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!P(t)}const te=N({name:"BookcaseNew",setup(){const{t}=y({useScope:"global"}),{router:n}=z(),{message:c,dialog:u}=j("top"),i=T(),o=C(""),s=C(),g=()=>{const{width:a=v,height:l=v}=s.value||{},I={...E,width:a,height:l},p=[];for(let b=0;b<a;b++)for(let d=0;d<l;d++)p.push({from:[b,d],to:[b+1,d+1],merge:!1});i.value={meta:I,cells:p}};q(()=>{u.create({title:t("pages.bookcase.newBookcase.initDialog.title"),closable:!1,maskClosable:!1,closeOnEsc:!1,content:()=>e(U,{size:s.value,onChange:a=>{s.value=a}},null),positiveText:t("common.confirm"),negativeText:t("common.forgetIt"),onPositiveClick(){g()},onNegativeClick(){n.back()}})}),O(()=>{u.destroyAll()});const m=C(),_=()=>{var a;(a=m.value)==null||a.mergeCells()},S=()=>{var a;(a=m.value)==null||a.breakCell()},x=()=>{var l;if(!o.value){c.error(t("pages.bookcase.newBookcase.bookcaseName.required"));return}const a=(l=m.value)==null?void 0:l.getData();R.bookcase.createNewBookcase({...a,name:o.value}).then(()=>{n.replace("/bookcase/list")})};return()=>{let a;return e(L,{topBar:e(A,{rightSlots:[e(h,{onClick:x},{default:()=>[e(k,{name:"save"},null)]})]},J(a=t("pages.bookcase.newBookcase.topbar.title"))?a:{default:()=>[a]}),toolBar:[e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:()=>{var l;(l=m.value)==null||l.resetView()}},{default:()=>[e(k,{name:"restore"},null)]}),e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:_},{default:()=>[e(k,{name:"mergeCells"},null)]}),e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:S},{default:()=>[e(k,{name:"breakCells"},null)]})]},{default:()=>[e("div",{class:f(r["new-bookcase"])},[e("div",{class:f(r.title,r.blur)},[e(V,{isDual:"editonly",value:o.value,onChange:l=>{o.value=l}},null)]),e(D,{ref:m,data:i.value},null)])]})}}});export{te as default};
