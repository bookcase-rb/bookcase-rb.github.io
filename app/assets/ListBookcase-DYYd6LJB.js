import{d as D,t as T,u as I,a as F,r as c,w as _,c as o,e as k,B as L,g as M,S as b,f as g,o as N,i as P,I as $}from"./index-B3qSu1dX.js";import{u as S}from"./useTRouter-D4zg8088.js";import{B as j,a as E}from"./BasicTopBar-pM3hxXIp.js";import{E as V}from"./Empty-CRGTeLZl.js";import{d as A}from"./vue-utils-BhyqPCEr.js";import{D as O}from"./DeleteConfirmButton-ogdrf5qP.js";import{B as W}from"./BookcasePreview-CI3Qpvrl.js";import"./Popconfirm-m6vKgCnE.js";import"./Popover-Dpij0fg9.js";import"./get-DrtZLwal.js";import"./utils-7_mGPhvC.js";const q="_waterfall_1lwwv_1",z="_mask_1lwwv_28",Y="_shown_1lwwv_45",f={waterfall:q,"bookcase-waterfall-list":"_bookcase-waterfall-list_1lwwv_11","waterfall-item":"_waterfall-item_1lwwv_20",mask:z,shown:Y},G=D({name:"WaterfallList",props:{list:{type:Array,default:()=>[]},onReloadData:{type:Function}},setup(l){const{list:r}=T(l),{t:d}=I({useScope:"global"}),{router:p}=S(),{message:h}=F(),n=c(),u=c(!1),y=c(0),m=c([]),v=c([]);_(r,t=>{m.value=Array(t.length).fill(void 0)},{immediate:!0}),_(m,t=>{if(t.filter(e=>e===void 0).length!==r.value.length){u.value=!0;const e=[],a=[0,0];for(let s=0;s<t.length;s++)a[0]<=a[1]?(e.push([0,a[0]]),a[0]+=t[s]):(e.push([1,a[1]]),a[1]+=t[s]);v.value=e,y.value=Math.max(...a)}},{immediate:!0});const C=t=>{var s;t.stopPropagation();const e=t.target,a=(s=e==null?void 0:e.dataset)==null?void 0:s.id;a!==void 0?n.value=a:n.value=void 0},R=t=>{var a;const e=(a=r.value[t])==null?void 0:a.id;e&&g.book.queryBookByBookcaseId(e).then(s=>{s!=null&&s.length?h.error(d("pages.bookcase.list.waterfallList.cannotDelete.message")):g.bookcase.deleteBookcase(e).then(()=>{var i;(i=l.onReloadData)==null||i.call(l),n.value=void 0})})};return()=>o("div",{class:k(f.waterfall),onClick:()=>{n.value=void 0}},[o("ul",{class:k(f["bookcase-waterfall-list"]),style:{height:`${y.value+1}px`},onClick:C},[r.value.map((t,e)=>{let a=(Math.random()-.5)*1e3+"px",s=(Math.random()-.5)*2e3+"px";if(v.value[e]){const i=v.value[e]||[0,0];a=i[0]===0?"0%":"100%",s=i[1]+"px"}return o("li",{key:t.id,class:k(f["waterfall-item"]),style:{visibility:u.value?"visible":"hidden",transform:`translate(${a}, ${s})`},"data-id":t.id},[o("div",{class:k(f.mask,{[f.shown]:n.value===t.id})},[o(L,{circle:!0,onClick:()=>{p.push({path:`/bookcase/edit/${t.id}`})}},{default:()=>[M("👀️")]}),o(O,{circle:!0,onShow:i=>{i.stopPropagation()},onConfirm:()=>R(e)},{default:()=>[o(b,{name:"delete"},null)]})]),o(W,{bookcaseId:t.id,onSizeLoad:(i,x)=>{const w=A(m.value);w[e]===void 0&&(w[e]=x,m.value=[...w])}},null)])})])])}});function B(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!P(l)}const se=D({name:"ListBookcase",setup(){const{t:l}=I({useScope:"global"}),{router:r}=S(),d=c([]);function p(){g.bookcase.getBookcases().then(n=>{d.value=n})}N(()=>{p()});const h=()=>d.value.length===0?o(V,{title:l("pages.bookcase.list.empty.title"),description:o($,{scope:"global",keypath:"pages.bookcase.list.empty.description"},{default:()=>[o(b,{name:"plus"},null)]})},null):o(G,{list:d.value,onReloadData:p},null);return()=>{let n,u;return o(E,{topBar:o(j,{rightSlots:[o(L,{onClick:()=>{r.push({path:"/bookcase/new"})}},{default:()=>[o(b,{name:"plus"},null)]})]},B(n=l("pages.bookcase.list.topbar.title"))?n:{default:()=>[n]})},B(u=h())?u:{default:()=>[u]})}}});export{se as default};
//# sourceMappingURL=ListBookcase-DYYd6LJB.js.map
