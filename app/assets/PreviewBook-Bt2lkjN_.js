import{y as Y,a5 as B,z as R,E as z,_ as y,G as j,a6 as ue,H as pe,d as P,K as ve,J as D,a7 as fe,L as O,M as ge,r as I,v as C,P as Z,a8 as be,a9 as me,aa as he,ab as Ce,ac as ke,ad as xe,ae as Ie,af as ye,ag as Te,ah as we,a3 as S,x as Se,Z as _e,ai as Be,aj as Re,t as F,c as e,S as W,u as Q,ak as E,e as x,F as ze,I as M,g as $,al as X,am as Pe,w as ee,B as H,i as $e,f as V}from"./index-Bk_Q6iwp.js";import{u as oe}from"./useTRouter-BIOIhU90.js";import{t as Oe,N as Le,a as Ee,b as je}from"./Image-BOQ1Gr6z.js";import{N as De}from"./Rate-BCurNBux.js";import{a as He,B as U}from"./BasicTopBar-n8OglYHh.js";import{D as Ae,a as Ne}from"./DeckerLayout-DVgQt0VZ.js";import{B as We}from"./BookcasePreview-DnXoU7rY.js";import"./Popover-0REC5pKa.js";import"./get-BJieqKi6.js";import"./constants-B_2QCv6E.js";const Fe={iconMargin:"11px 8px 0 12px",iconMarginRtl:"11px 12px 0 8px",iconSize:"24px",closeIconSize:"16px",closeSize:"20px",closeMargin:"13px 14px 0 0",closeMarginRtl:"13px 0 0 14px",padding:"13px"};function Me(o){const{lineHeight:l,borderRadius:v,fontWeightStrong:t,baseColor:a,dividerColor:m,actionColor:g,textColor1:d,textColor2:n,closeColorHover:i,closeColorPressed:c,closeIconColor:p,closeIconColorHover:f,closeIconColorPressed:u,infoColor:r,successColor:T,warningColor:s,errorColor:b,fontSize:h}=o;return Object.assign(Object.assign({},Fe),{fontSize:h,lineHeight:l,titleFontWeight:t,borderRadius:v,border:`1px solid ${m}`,color:g,titleTextColor:d,iconColor:n,contentTextColor:n,closeBorderRadius:v,closeColorHover:i,closeColorPressed:c,closeIconColor:p,closeIconColorHover:f,closeIconColorPressed:u,borderInfo:`1px solid ${B(a,R(r,{alpha:.25}))}`,colorInfo:B(a,R(r,{alpha:.08})),titleTextColorInfo:d,iconColorInfo:r,contentTextColorInfo:n,closeColorHoverInfo:i,closeColorPressedInfo:c,closeIconColorInfo:p,closeIconColorHoverInfo:f,closeIconColorPressedInfo:u,borderSuccess:`1px solid ${B(a,R(T,{alpha:.25}))}`,colorSuccess:B(a,R(T,{alpha:.08})),titleTextColorSuccess:d,iconColorSuccess:T,contentTextColorSuccess:n,closeColorHoverSuccess:i,closeColorPressedSuccess:c,closeIconColorSuccess:p,closeIconColorHoverSuccess:f,closeIconColorPressedSuccess:u,borderWarning:`1px solid ${B(a,R(s,{alpha:.33}))}`,colorWarning:B(a,R(s,{alpha:.08})),titleTextColorWarning:d,iconColorWarning:s,contentTextColorWarning:n,closeColorHoverWarning:i,closeColorPressedWarning:c,closeIconColorWarning:p,closeIconColorHoverWarning:f,closeIconColorPressedWarning:u,borderError:`1px solid ${B(a,R(b,{alpha:.25}))}`,colorError:B(a,R(b,{alpha:.08})),titleTextColorError:d,iconColorError:b,contentTextColorError:n,closeColorHoverError:i,closeColorPressedError:c,closeIconColorError:p,closeIconColorHoverError:f,closeIconColorPressedError:u})}const Ve={name:"Alert",common:Y,self:Me},Ue=z("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[y("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),j("closable",[z("alert-body",[y("title",`
 padding-right: 24px;
 `)])]),y("icon",{color:"var(--n-icon-color)"}),z("alert-body",{padding:"var(--n-padding)"},[y("title",{color:"var(--n-title-text-color)"}),y("content",{color:"var(--n-content-text-color)"})]),ue({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),y("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),y("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),j("show-icon",[z("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),j("right-adjust",[z("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),z("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[y("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[pe("& +",[y("content",{marginTop:"9px"})])]),y("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),y("icon",{transition:"color .3s var(--n-bezier)"})]),qe=Object.assign(Object.assign({},D.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ke=P({name:"Alert",inheritAttrs:!1,props:qe,slots:Object,setup(o){const{mergedClsPrefixRef:l,mergedBorderedRef:v,inlineThemeDisabled:t,mergedRtlRef:a}=ve(o),m=D("Alert","-alert",Ue,Ve,o,l),g=fe("Alert",a,l),d=O(()=>{const{common:{cubicBezierEaseInOut:u},self:r}=m.value,{fontSize:T,borderRadius:s,titleFontWeight:b,lineHeight:h,iconSize:_,iconMargin:L,iconMarginRtl:le,closeIconSize:te,closeBorderRadius:ne,closeSize:re,closeMargin:se,closeMarginRtl:ae,padding:ie}=r,{type:w}=o,{left:ce,right:de}=we(L);return{"--n-bezier":u,"--n-color":r[S("color",w)],"--n-close-icon-size":te,"--n-close-border-radius":ne,"--n-close-color-hover":r[S("closeColorHover",w)],"--n-close-color-pressed":r[S("closeColorPressed",w)],"--n-close-icon-color":r[S("closeIconColor",w)],"--n-close-icon-color-hover":r[S("closeIconColorHover",w)],"--n-close-icon-color-pressed":r[S("closeIconColorPressed",w)],"--n-icon-color":r[S("iconColor",w)],"--n-border":r[S("border",w)],"--n-title-text-color":r[S("titleTextColor",w)],"--n-content-text-color":r[S("contentTextColor",w)],"--n-line-height":h,"--n-border-radius":s,"--n-font-size":T,"--n-title-font-weight":b,"--n-icon-size":_,"--n-icon-margin":L,"--n-icon-margin-rtl":le,"--n-close-size":re,"--n-close-margin":se,"--n-close-margin-rtl":ae,"--n-padding":ie,"--n-icon-margin-left":ce,"--n-icon-margin-right":de}}),n=t?ge("alert",O(()=>o.type[0]),d,o):void 0,i=I(!0),c=()=>{const{onAfterLeave:u,onAfterHide:r}=o;u&&u(),r&&r()};return{rtlEnabled:g,mergedClsPrefix:l,mergedBordered:v,visible:i,handleCloseClick:()=>{var u;Promise.resolve((u=o.onClose)===null||u===void 0?void 0:u.call(o)).then(r=>{r!==!1&&(i.value=!1)})},handleAfterLeave:()=>{c()},mergedTheme:m,cssVars:t?void 0:d,themeClass:n==null?void 0:n.themeClass,onRender:n==null?void 0:n.onRender}},render(){var o;return(o=this.onRender)===null||o===void 0||o.call(this),C(Te,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:l,$slots:v}=this,t={class:[`${l}-alert`,this.themeClass,this.closable&&`${l}-alert--closable`,this.showIcon&&`${l}-alert--show-icon`,!this.title&&this.closable&&`${l}-alert--right-adjust`,this.rtlEnabled&&`${l}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?C("div",Object.assign({},Z(this.$attrs,t)),this.closable&&C(be,{clsPrefix:l,class:`${l}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&C("div",{class:`${l}-alert__border`}),this.showIcon&&C("div",{class:`${l}-alert__icon`,"aria-hidden":"true"},me(v.icon,()=>[C(he,{clsPrefix:l},{default:()=>{switch(this.type){case"success":return C(Ie,null);case"info":return C(xe,null);case"warning":return C(ke,null);case"error":return C(Ce,null);default:return null}}})])),C("div",{class:[`${l}-alert-body`,this.mergedBordered&&`${l}-alert-body--bordered`]},ye(v.header,a=>{const m=a||this.title;return m?C("div",{class:`${l}-alert-body__title`},m):null}),v.default&&C("div",{class:`${l}-alert-body__content`},v))):null}})}}),Ge=Se({name:"Ellipsis",common:Y,peers:{Tooltip:Oe}}),Je=z("ellipsis",{overflow:"hidden"},[_e("line-clamp",`
 white-space: nowrap;
 display: inline-block;
 vertical-align: bottom;
 max-width: 100%;
 `),j("line-clamp",`
 display: -webkit-inline-box;
 -webkit-box-orient: vertical;
 `),j("cursor-pointer",`
 cursor: pointer;
 `)]);function q(o){return`${o}-ellipsis--line-clamp`}function K(o,l){return`${o}-ellipsis--cursor-${l}`}const Ye=Object.assign(Object.assign({},D.props),{expandTrigger:String,lineClamp:[Number,String],tooltip:{type:[Boolean,Object],default:!0}}),Ze=P({name:"Ellipsis",inheritAttrs:!1,props:Ye,slots:Object,setup(o,{slots:l,attrs:v}){const t=Be(),a=D("Ellipsis","-ellipsis",Je,Ge,o,t),m=I(null),g=I(null),d=I(null),n=I(!1),i=O(()=>{const{lineClamp:s}=o,{value:b}=n;return s!==void 0?{textOverflow:"","-webkit-line-clamp":b?"":s}:{textOverflow:b?"":"ellipsis","-webkit-line-clamp":""}});function c(){let s=!1;const{value:b}=n;if(b)return!0;const{value:h}=m;if(h){const{lineClamp:_}=o;if(u(h),_!==void 0)s=h.scrollHeight<=h.offsetHeight;else{const{value:L}=g;L&&(s=L.getBoundingClientRect().width<=h.getBoundingClientRect().width)}r(h,s)}return s}const p=O(()=>o.expandTrigger==="click"?()=>{var s;const{value:b}=n;b&&((s=d.value)===null||s===void 0||s.setShow(!1)),n.value=!b}:void 0);Re(()=>{var s;o.tooltip&&((s=d.value)===null||s===void 0||s.setShow(!1))});const f=()=>C("span",Object.assign({},Z(v,{class:[`${t.value}-ellipsis`,o.lineClamp!==void 0?q(t.value):void 0,o.expandTrigger==="click"?K(t.value,"pointer"):void 0],style:i.value}),{ref:"triggerRef",onClick:p.value,onMouseenter:o.expandTrigger==="click"?c:void 0}),o.lineClamp?l:C("span",{ref:"triggerInnerRef"},l));function u(s){if(!s)return;const b=i.value,h=q(t.value);o.lineClamp!==void 0?T(s,h,"add"):T(s,h,"remove");for(const _ in b)s.style[_]!==b[_]&&(s.style[_]=b[_])}function r(s,b){const h=K(t.value,"pointer");o.expandTrigger==="click"&&!b?T(s,h,"add"):T(s,h,"remove")}function T(s,b,h){h==="add"?s.classList.contains(b)||s.classList.add(b):s.classList.contains(b)&&s.classList.remove(b)}return{mergedTheme:a,triggerRef:m,triggerInnerRef:g,tooltipRef:d,handleClick:p,renderTrigger:f,getTooltipDisabled:c}},render(){var o;const{tooltip:l,renderTrigger:v,$slots:t}=this;if(l){const{mergedTheme:a}=this;return C(Le,Object.assign({ref:"tooltipRef",placement:"top"},l,{getDisabled:this.getTooltipDisabled,theme:a.peers.Tooltip,themeOverrides:a.peerOverrides.Tooltip}),{trigger:v,default:(o=t.tooltip)!==null&&o!==void 0?o:t.default})}else return v()}}),A=P({name:"Text",props:{text:{type:[String,Number],default:""},placeholder:{type:String,default:"-"}},setup(o){const{text:l,placeholder:v}=F(o),t=()=>{const a=String(l.value);return a||v.value};return()=>t()}}),Qe="_label_1v9m3_1",Xe="_item_1v9m3_4",k={"book-details":"_book-details_1v9m3_1",label:Qe,item:Xe,"book-cover-image":"_book-cover-image_1v9m3_13"},eo=P({name:"BookDetails",props:{bookData:{type:Object,default:()=>({})},locationIcon:{type:Object,default:()=>e(W,{name:"locationPin"},null)},onRateChange:{type:Function}},setup(o){const{bookData:l,locationIcon:v}=F(o),{t}=Q({useScope:"global"}),a=O(()=>{var g,d,n;const m=(d=(g=l.value)==null?void 0:g.covers)==null?void 0:d[0];return X(m,(n=l.value)==null?void 0:n.title)});return()=>{var m,g,d,n,i,c,p,f,u;return e("div",{class:x(k["book-details"])},[e("h1",null,[(m=l.value)==null?void 0:m.title]),e("p",{style:{fontWeight:600}},[(g=l.value)==null?void 0:g.isbn]),e("p",{style:{fontWeight:600}},[E((d=l.value)==null?void 0:d.authors,t("pages.book.preview.detail.noAuthor"),k.item)]),e("p",null,[e(De,{value:(n=l.value)==null?void 0:n.rating,allowHalf:!0,onUpdateValue:o.onRateChange,readonly:!0},null)]),e("p",null,[e(Ee,{class:x(k["book-cover-image"]),src:a.value,renderToolbar:({nodes:r})=>e(ze,null,[r.zoomIn,r.resizeToOriginalSize,r.zoomOut])},null)]),e("p",null,[e(Ke,{showIcon:!1,type:"info"},{default:()=>[e(M,{scope:"global",keypath:"pages.book.preview.detail.location"},{default:()=>[e(je,null,{default:()=>[v.value]})]})]})]),e("h3",null,[t("pages.book.preview.detail.details")]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.publishers.label"),$(":")]),E((i=l.value)==null?void 0:i.publishers,t("pages.book.preview.detail.noPublisher"),k.item)]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.publishDate.label"),$(":")]),e(A,{text:(c=l.value)==null?void 0:c.publishDate},null)]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.languages.label"),$(":")]),E((p=l.value)==null?void 0:p.languages,t("pages.book.preview.detail.noLanguage"),k.item)]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.numberOfPages.label"),$(":")]),e(M,{scope:"global",keypath:"pages.book.preview.detail.numberOfPages.text"},{default:()=>{var r;return[e(A,{text:(r=l.value)==null?void 0:r.numberOfPages,placeholder:t("pages.book.preview.detail.numberOfPages.placeholder")},null)]}})]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.tags.label"),$(":")]),E((f=l.value)==null?void 0:f.tags,t("pages.book.preview.detail.noTags"),k.item)]),e("p",null,[e("span",{class:x(k.label)},[t("pages.book.bookForm.form.subjects.label"),$(":")]),E((u=l.value)==null?void 0:u.subjects,t("pages.book.preview.detail.noSubject"),k.item)]),e("p",null,[e("h3",null,[t("pages.book.preview.detail.summary")]),e("div",null,[e(Ze,{expandTrigger:"click",lineClamp:5,tooltip:!1},{default:()=>{var r;return[e(A,{text:(r=l.value)==null?void 0:r.summary},null)]}})])])])}}}),oo="_flip_ay5yt_24",G={"duplicate-books-icon":"_duplicate-books-icon_ay5yt_1",flip:oo},lo=P({name:"DuplicateBooksIcon",props:{cover:{type:Blob},title:{type:String}},setup(o){const{cover:l,title:v}=F(o),t=O(()=>X(l.value,v.value)),a=I(!1);return setTimeout(()=>{Pe(()=>{a.value=!0})},1e3),()=>e("div",{class:x(G["duplicate-books-icon"],{[G.flip]:a.value}),style:{"--background-image":`url(${t.value})`}},["⬜️"])}}),J={"book-location":"_book-location_1s333_1","preview-card":"_preview-card_1s333_7"},to=P({name:"BookLocation",props:{bookcaseIds:{type:Array,default:()=>[]}},setup(o){const{router:l}=oe(),v=I([]),t=I(!1),a=I([]),m=I(0);return ee(v.value,g=>{if(g.filter(d=>d!==void 0).length===o.bookcaseIds.length){t.value=!0;const d=[],n=[0,0];for(let i=0;i<g.length;i++)n[0]<=n[1]?(d.push([0,n[0]]),n[0]+=g[i]):(d.push([1,n[1]]),n[1]+=g[i]);a.value=d,m.value=Math.max(...n)}}),()=>e("div",{class:x(J["book-location"]),style:{height:`${m.value+1}px`}},[o.bookcaseIds.map((g,d)=>{const n=a.value[d]||[0,0],i=n[0]===0?"0%":"100%",c=n[1]+"px";return e("div",{class:x(J["preview-card"]),style:{visibility:t.value?"visible":"hidden",transform:`translate(${i}, ${c})`},onClick:()=>{l.push(`/cell/${g.cellId}`)}},[e(We,{key:g.bookcaseId,bookcaseId:g.bookcaseId,selectedCellId:g.cellId,onSizeLoad:(p,f)=>{v.value[d]=f},isLocated:d===0},null)])})])}}),no={"preview-book":"_preview-book_ozp5a_1"};function N(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!$e(o)}const bo=P({name:"PreviewBook",setup(){const{t:o}=Q({useScope:"global"}),{route:l,router:v}=oe(),t=I(),a=I([]);ee(()=>l.params,i=>{const{isbn:c,id:p}=i;p?V.book.queryRelatedBooksByBookId(p).then(f=>{if(f!=null&&f.length){const[u,...r]=f;t.value=u,a.value=r||[]}}):c&&V.book.queryFirstBookByIsbn(c).then(f=>{if(f!=null&&f.length){const[u,...r]=f;t.value=u,a.value=r||[]}})},{immediate:!0});const m=()=>{var i,c,p;return a.value.length?e(lo,{cover:(c=(i=t.value)==null?void 0:i.covers)==null?void 0:c[0],title:(p=t.value)==null?void 0:p.title},null):e(W,{name:"locationPin"},null)};function g(){var c;const i=(c=t.value)==null?void 0:c.id;i&&v.push({path:`/book/edit/id/${i}`,replace:!0})}const d=i=>{let c;return e("div",{class:x(no["preview-book"])},[e(He,{topBar:e(U,{rightSlots:[e(H,{onClick:i},N(c=m())?c:{default:()=>[c]}),e(H,{onClick:g},{default:()=>[e(W,{name:"pencil"},null)]})]},{default:()=>{var p;return[((p=t.value)==null?void 0:p.title)||"-"]}})},{default:()=>[e(eo,{bookData:t.value,locationIcon:m()},null)]})])},n=i=>{let c,p;const f=[t.value,...a.value].filter(u=>!!u).map(u=>({bookcaseId:u.bookcaseId,cellId:u.cellId}));return e(Ne,{topBar:e(U,{leftSlots:[e(H,{text:!0,onClick:i},N(c=o("common.close"))?c:{default:()=>[c]})]},N(p=o("pages.book.preview.decker.topbar.title"))?p:{default:()=>[p]})},{default:()=>[e(to,{bookcaseIds:f},null)]})};return()=>e(Ae,null,{default:d,decker:n})}});export{bo as default};
//# sourceMappingURL=PreviewBook-Bt2lkjN_.js.map
