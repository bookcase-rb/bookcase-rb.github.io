import{K as b,r as K}from"./constants-B_2QCv6E.js";import{d as N,t as O,u as P,r as g,w as U,c as o,e as f,f as W}from"./index-Bk_Q6iwp.js";const h={"bookcase-preview-container":"_bookcase-preview-container_1hd3b_1","bookcase-preview":"_bookcase-preview_1hd3b_1","bookcase-preview-image":"_bookcase-preview-image_1hd3b_16"},A=N({name:"BookcasePreview",props:{bookcaseId:{type:String,required:!1},selectedCellId:{type:String,required:!1},isLocated:{type:Boolean,default:!1},onSizeLoad:{type:Function,required:!1}},setup(s){const{bookcaseId:p,selectedCellId:k,isLocated:y}=O(s),{t:L}=P({useScope:"global"}),u=g();U(()=>p.value,t=>{t&&W.bookcase.queryBookcaseById(t).then(a=>{a&&(_(a),u.value=a.name)})},{immediate:!0});const v=g();function _(t){const{meta:a,cells:n}=t,{unit:e,fill:l,fillSelected:I}=a,S=(a.width*e||300)+4,C=(a.height*e||300)+4;let m=document.createElement("div");const i=new b.Stage({container:m,x:2,y:2,width:S,height:C,draggable:!1}),c=new b.Layer;i.add(c),n.forEach(r=>{const{from:d,to:w,id:q}=r,E=d[0]*e,R=d[1]*e,x=(w[1]-d[1])*e,z=(w[0]-d[0])*e,H=new b.Rect({y:R,x:E,width:z,height:x,fill:q===k.value?I:l,cell:{...r},...K});c.add(H),c.draw()}),i.toBlob({}).then(r=>{v.value=r,c.clear(),c.clearCache(),i.clear(),i.clearCache(),m=null})}const B=t=>{var e,l;const n=(e=t.target.parentElement)==null?void 0:e.parentElement;(l=s.onSizeLoad)==null||l.call(s,n.clientWidth,n.clientHeight)};return()=>o("div",{class:f(h["bookcase-preview-container"])},[o("div",{class:f(h["bookcase-preview"])},[o("img",{class:f(h["bookcase-preview-image"]),src:v.value&&URL.createObjectURL(v.value),alt:u.value,onLoad:B},null),o("div",null,[o("span",null,[u.value]),o("span",null,[y.value?L("pages.bookcase.preview.current"):""])])])])}});export{A as B};
//# sourceMappingURL=BookcasePreview-DnXoU7rY.js.map
