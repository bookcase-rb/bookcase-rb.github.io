import{u as I}from"./useTRouter-DrdLBt2-.js";import{d as N,t as F,u as y,c as e,f as j,s as q,r as p,o as O,g as P,b as f,B as h,S as k,i as R,a as T}from"./index-xXUSe0Yl.js";import{B as V,E as D}from"./BookcaseNameInput-C2XJzwKw.js";import{d as v,a as E}from"./constants-BQC0jt1H.js";import{N as C,a as M}from"./FormItem-BVQFypl8.js";import{N as B}from"./InputNumber-C5ymcdMw.js";import{B as A,a as L}from"./BasicTopBar-9BxYEg7y.js";import"./get-DXNG7MMF.js";const U=N({name:"InitForm",props:{size:{type:Object,default:{width:v,height:v}},onChange:{type:Function}},setup(t){var i;const{size:s}=F(t),{t:c}=y({useScope:"global"});(i=t.onChange)==null||i.call(t,s.value);function u(o,n){var d;o!==null&&(s.value[n]=o,(d=t.onChange)==null||d.call(t,s.value))}return()=>e(M,{style:{marginTop:"24px"},inline:!0,labelPlacement:"left",model:s.value},{default:()=>[e(C,{label:c("common.width"),path:"width"},{default:()=>{var o;return[e(B,{placeholder:c("common.width"),buttonPlacement:"both",min:1,max:20,value:(o=s.value)==null?void 0:o.width,onChange:n=>u(n,"width")},null)]}}),e(C,{label:c("common.height"),path:"height"},{default:()=>{var o;return[e(B,{placeholder:c("common.height"),buttonPlacement:"both",min:1,max:20,value:(o=s.value)==null?void 0:o.height,onChange:n=>u(n,"height")},null)]}})]})}}),G="_title_1uqxc_6",H="_blur_1uqxc_13",r={"new-bookcase":"_new-bookcase_1uqxc_1",title:G,blur:H};function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!R(t)}const te=N({name:"BookcaseNew",setup(){const{t}=y({useScope:"global"}),{router:s}=I(),{message:c,dialog:u}=j("top"),i=q(),o=p(""),n=p(),d=()=>{const{width:a=v,height:l=v}=n.value||{},z={...E,width:a,height:l},w=[];for(let b=0;b<a;b++)for(let g=0;g<l;g++)w.push({from:[b,g],to:[b+1,g+1],merge:!1});i.value={meta:z,cells:w}};O(()=>{u.create({title:t("pages.bookcase.newBookcase.initDialog.title"),closable:!1,maskClosable:!1,closeOnEsc:!1,content:()=>e(U,{size:n.value,onChange:a=>{n.value=a}},null),positiveText:t("common.confirm"),onPositiveClick(){d()}})}),P(()=>{u.destroyAll()});const m=p(),_=()=>{var a;(a=m.value)==null||a.mergeCells()},S=()=>{var a;(a=m.value)==null||a.breakCell()},x=()=>{var l;if(!o.value){c.error(t("pages.bookcase.newBookcase.bookcaseName.required"));return}const a=(l=m.value)==null?void 0:l.getData();T.bookcase.createNewBookcase({...a,name:o.value}).then(()=>{s.replace("/bookcase/list")})};return()=>{let a;return e(L,{topBar:e(A,{rightSlots:[e(h,{onClick:x},{default:()=>[e(k,{name:"save"},null)]})]},J(a=t("pages.bookcase.newBookcase.topbar.title"))?a:{default:()=>[a]}),toolBar:[e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:()=>{var l;(l=m.value)==null||l.resetView()}},{default:()=>[e(k,{name:"restore"},null)]}),e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:_},{default:()=>[e(k,{name:"mergeCells"},null)]}),e(h,{class:f(r.blur),size:"large",circle:!0,strong:!0,tertiary:!0,onClick:S},{default:()=>[e(k,{name:"breakCells"},null)]})]},{default:()=>[e("div",{class:f(r["new-bookcase"])},[e("div",{class:f(r.title,r.blur)},[e(V,{isDual:"editonly",value:o.value,onChange:l=>{o.value=l}},null)]),e(D,{ref:m,data:i.value},null)])]})}}});export{te as default};
