import{d as b,u as y,a as S,c as e,e as l,f as g,b0 as F,b1 as V,r as v,o as I,b2 as N,F as P,b3 as j,B as k,b4 as w,b5 as O,S as R,g as L,i as M}from"./index-Bk_Q6iwp.js";import{B as D,a as K}from"./BasicTopBar-n8OglYHh.js";import{D as q,a as z}from"./DeckerLayout-DVgQt0VZ.js";import{d as E}from"./vue-utils-DtDNsWW1.js";import"./useTRouter-BIOIhU90.js";const G="_settings_1lm4l_1",H="_list_1lm4l_1",J="_catogory_1lm4l_6",Q="_item_1lm4l_12",U="_label_1lm4l_23",W="_danger_1lm4l_30",X="_value_1lm4l_33",Y="_control_1lm4l_42",a={settings:G,list:H,catogory:J,item:Q,label:U,danger:W,value:X,control:Y},Z=b({name:"ClearData",setup(){const{t}=y({useScope:"global"}),{dialog:n,message:u}=S();return()=>e("li",{class:l(a.item),onClick:()=>{n.warning({title:t("pages.settings.clearData.confirmDialog.title"),content:t("pages.settings.clearData.confirmDialog.content"),positiveText:t("common.yes"),negativeText:t("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([g.book.clearAllBooks(),g.bookcase.clearAllBookcases(),g.settings.clearAllSettings()]).then(()=>{u.success(t("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:l(a.label,a.danger)},[t("pages.settings.clearData.label")]),e("span",{class:l(a.value)},null)])}}),$=b({name:"ResetConfig",setup(){const{t}=y({useScope:"global"}),{dialog:n,message:u}=S();return()=>e("li",{class:l(a.item),onClick:()=>{n.warning({title:t("pages.settings.resetConfig.confirmDialog.title"),content:t("pages.settings.resetConfig.confirmDialog.content"),positiveText:t("common.yes"),negativeText:t("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){g.settings.clearAllSettings().then(()=>{const m=F.map((r,d)=>({...r,index:d}));return g.settings.batchCreateSettings(m)}).then(()=>{u.success(t("pages.settings.resetConfig.confirmDialog.resetFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:l(a.label,a.danger)},[t("pages.settings.resetConfig.label")]),e("span",{class:l(a.value)},null)])}});function h(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!M(t)}const ne=b({name:"Settings",setup(){const{updateSettingMap:t}=V(),{t:n}=y({useScope:"global"}),{message:u}=S(),m=v([]),r=v(),d=v(),_=()=>Promise.all(N.map(o=>g.settings.getSettingsByCategory(o))).then(o=>{m.value=o});I(()=>{_()});const C=o=>{const{key:i,value:c}=o;return g.settings.updateSettingValueByKey(i,c).then(()=>{u.success(n("pages.settings.decker.topbar.saveSuccess")),t(i,c)}).catch(()=>{u.error(n("pages.settings.decker.topbar.saveFailed")),_()})},B=o=>{let i,c;if(d.value===void 0||r.value===void 0)return o(),e(P,null,null);const s=d.value;return e(z,{topBar:e(D,{leftSlots:[e(k,{text:!0,onClick:o},h(i=n("common.cancel"))?i:{default:()=>[i]})],rightSlots:[e(k,{text:!0,type:"primary",onClick:()=>{const{key:p}=s,f=m.value[r.value],T=f.findIndex(A=>A.key===p);f.splice(T,1,s),m.value.splice(r.value,1,f),C(s).finally(()=>{d.value=void 0,r.value=void 0,o()})}},h(c=n("common.save"))?c:{default:()=>[c]})]},null)},{default:()=>{var p;return[e("div",{class:a.control},[e("div",null,[n(s.label)]),j(s,f=>{s.value=f}),e("div",null,[(p=s.control)==null?void 0:p.description])])]}})},x=o=>e(K,{topBar:e(D,null,{default:()=>[e(R,{name:"setting"},null),L(" "),n("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[n("pages.settings.topbar.title")]),e("ul",{class:l(a.list)},[m.value.map((i,c)=>e("div",{class:l(a.catogory)},[i.filter(s=>!s.hidden).map(s=>e("li",{key:s.key,class:l(a.item),onClick:()=>{w(s)&&(r.value=c,d.value=E(s),o())}},[e("span",{class:l(a.label)},[n(s.label)]),e("span",{class:l(a.value)},[O(s,p=>{s.value=p,C(s)})])]))])),e("div",{class:l(a.catogory)},[e($,null,null),e(Z,null,null)])])]});return()=>e(q,{class:l(a.settings)},{default:x,decker:B})}});export{ne as default};
//# sourceMappingURL=Settings-DgmR3Z8x.js.map
