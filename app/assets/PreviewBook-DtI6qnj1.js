import{y as Y,a5 as S,z as _,E as R,_ as x,G as E,a6 as ue,H as pe,d as z,K as ve,J as j,a7 as fe,L as P,M as ge,r as k,v as C,P as Z,a8 as be,a9 as he,aa as me,ab as Ce,ac as ke,ad as xe,ae as Ie,af as ye,ag as Te,ah as we,a3 as T,x as Se,Z as _e,ai as Be,aj as Re,t as N,c as t,S as F,u as Q,g as M,e as $,F as ze,I as W,ak as Pe,w as X,B as A,i as $e,f as q}from"./index-n8WRPimo.js";import{u as ee}from"./useTRouter-CzE_LlLf.js";import{l as O,N as Le,g as oe}from"./utils-Dk8xp9Lt.js";import{t as Oe,N as Ee,a as je,b as Ae}from"./Image-BU4h6QCP.js";import{a as De,B as V}from"./BasicTopBar-DKU1SHVf.js";import{D as He,a as Fe}from"./DeckerLayout-DIaoEkOj.js";import{B as Ne}from"./BookcasePreview-CgB9wxGU.js";import"./Popover-qF0i0i3l.js";import"./get-Cba6XoKv.js";import"./constants-BANyBhw4.js";const Me={iconMargin:"11px 8px 0 12px",iconMarginRtl:"11px 12px 0 8px",iconSize:"24px",closeIconSize:"16px",closeSize:"20px",closeMargin:"13px 14px 0 0",closeMarginRtl:"13px 0 0 14px",padding:"13px"};function We(e){const{lineHeight:o,borderRadius:v,fontWeightStrong:l,baseColor:a,dividerColor:h,actionColor:g,textColor1:d,textColor2:n,closeColorHover:i,closeColorPressed:c,closeIconColor:p,closeIconColorHover:f,closeIconColorPressed:u,infoColor:r,successColor:I,warningColor:s,errorColor:b,fontSize:m}=e;return Object.assign(Object.assign({},Me),{fontSize:m,lineHeight:o,titleFontWeight:l,borderRadius:v,border:`1px solid ${h}`,color:g,titleTextColor:d,iconColor:n,contentTextColor:n,closeBorderRadius:v,closeColorHover:i,closeColorPressed:c,closeIconColor:p,closeIconColorHover:f,closeIconColorPressed:u,borderInfo:`1px solid ${S(a,_(r,{alpha:.25}))}`,colorInfo:S(a,_(r,{alpha:.08})),titleTextColorInfo:d,iconColorInfo:r,contentTextColorInfo:n,closeColorHoverInfo:i,closeColorPressedInfo:c,closeIconColorInfo:p,closeIconColorHoverInfo:f,closeIconColorPressedInfo:u,borderSuccess:`1px solid ${S(a,_(I,{alpha:.25}))}`,colorSuccess:S(a,_(I,{alpha:.08})),titleTextColorSuccess:d,iconColorSuccess:I,contentTextColorSuccess:n,closeColorHoverSuccess:i,closeColorPressedSuccess:c,closeIconColorSuccess:p,closeIconColorHoverSuccess:f,closeIconColorPressedSuccess:u,borderWarning:`1px solid ${S(a,_(s,{alpha:.33}))}`,colorWarning:S(a,_(s,{alpha:.08})),titleTextColorWarning:d,iconColorWarning:s,contentTextColorWarning:n,closeColorHoverWarning:i,closeColorPressedWarning:c,closeIconColorWarning:p,closeIconColorHoverWarning:f,closeIconColorPressedWarning:u,borderError:`1px solid ${S(a,_(b,{alpha:.25}))}`,colorError:S(a,_(b,{alpha:.08})),titleTextColorError:d,iconColorError:b,contentTextColorError:n,closeColorHoverError:i,closeColorPressedError:c,closeIconColorError:p,closeIconColorHoverError:f,closeIconColorPressedError:u})}const qe={name:"Alert",common:Y,self:We},Ve=R("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[x("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),E("closable",[R("alert-body",[x("title",`
 padding-right: 24px;
 `)])]),x("icon",{color:"var(--n-icon-color)"}),R("alert-body",{padding:"var(--n-padding)"},[x("title",{color:"var(--n-title-text-color)"}),x("content",{color:"var(--n-content-text-color)"})]),ue({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),x("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),x("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),E("show-icon",[R("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),E("right-adjust",[R("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),R("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[x("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[pe("& +",[x("content",{marginTop:"9px"})])]),x("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),x("icon",{transition:"color .3s var(--n-bezier)"})]),Ue=Object.assign(Object.assign({},j.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ke=z({name:"Alert",inheritAttrs:!1,props:Ue,slots:Object,setup(e){const{mergedClsPrefixRef:o,mergedBorderedRef:v,inlineThemeDisabled:l,mergedRtlRef:a}=ve(e),h=j("Alert","-alert",Ve,qe,e,o),g=fe("Alert",a,o),d=P(()=>{const{common:{cubicBezierEaseInOut:u},self:r}=h.value,{fontSize:I,borderRadius:s,titleFontWeight:b,lineHeight:m,iconSize:w,iconMargin:L,iconMarginRtl:te,closeIconSize:le,closeBorderRadius:ne,closeSize:re,closeMargin:se,closeMarginRtl:ae,padding:ie}=r,{type:y}=e,{left:ce,right:de}=we(L);return{"--n-bezier":u,"--n-color":r[T("color",y)],"--n-close-icon-size":le,"--n-close-border-radius":ne,"--n-close-color-hover":r[T("closeColorHover",y)],"--n-close-color-pressed":r[T("closeColorPressed",y)],"--n-close-icon-color":r[T("closeIconColor",y)],"--n-close-icon-color-hover":r[T("closeIconColorHover",y)],"--n-close-icon-color-pressed":r[T("closeIconColorPressed",y)],"--n-icon-color":r[T("iconColor",y)],"--n-border":r[T("border",y)],"--n-title-text-color":r[T("titleTextColor",y)],"--n-content-text-color":r[T("contentTextColor",y)],"--n-line-height":m,"--n-border-radius":s,"--n-font-size":I,"--n-title-font-weight":b,"--n-icon-size":w,"--n-icon-margin":L,"--n-icon-margin-rtl":te,"--n-close-size":re,"--n-close-margin":se,"--n-close-margin-rtl":ae,"--n-padding":ie,"--n-icon-margin-left":ce,"--n-icon-margin-right":de}}),n=l?ge("alert",P(()=>e.type[0]),d,e):void 0,i=k(!0),c=()=>{const{onAfterLeave:u,onAfterHide:r}=e;u&&u(),r&&r()};return{rtlEnabled:g,mergedClsPrefix:o,mergedBordered:v,visible:i,handleCloseClick:()=>{var u;Promise.resolve((u=e.onClose)===null||u===void 0?void 0:u.call(e)).then(r=>{r!==!1&&(i.value=!1)})},handleAfterLeave:()=>{c()},mergedTheme:h,cssVars:l?void 0:d,themeClass:n==null?void 0:n.themeClass,onRender:n==null?void 0:n.onRender}},render(){var e;return(e=this.onRender)===null||e===void 0||e.call(this),C(Te,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:o,$slots:v}=this,l={class:[`${o}-alert`,this.themeClass,this.closable&&`${o}-alert--closable`,this.showIcon&&`${o}-alert--show-icon`,!this.title&&this.closable&&`${o}-alert--right-adjust`,this.rtlEnabled&&`${o}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?C("div",Object.assign({},Z(this.$attrs,l)),this.closable&&C(be,{clsPrefix:o,class:`${o}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&C("div",{class:`${o}-alert__border`}),this.showIcon&&C("div",{class:`${o}-alert__icon`,"aria-hidden":"true"},he(v.icon,()=>[C(me,{clsPrefix:o},{default:()=>{switch(this.type){case"success":return C(Ie,null);case"info":return C(xe,null);case"warning":return C(ke,null);case"error":return C(Ce,null);default:return null}}})])),C("div",{class:[`${o}-alert-body`,this.mergedBordered&&`${o}-alert-body--bordered`]},ye(v.header,a=>{const h=a||this.title;return h?C("div",{class:`${o}-alert-body__title`},h):null}),v.default&&C("div",{class:`${o}-alert-body__content`},v))):null}})}}),Ge=Se({name:"Ellipsis",common:Y,peers:{Tooltip:Oe}}),Je=R("ellipsis",{overflow:"hidden"},[_e("line-clamp",`
 white-space: nowrap;
 display: inline-block;
 vertical-align: bottom;
 max-width: 100%;
 `),E("line-clamp",`
 display: -webkit-inline-box;
 -webkit-box-orient: vertical;
 `),E("cursor-pointer",`
 cursor: pointer;
 `)]);function U(e){return`${e}-ellipsis--line-clamp`}function K(e,o){return`${e}-ellipsis--cursor-${o}`}const Ye=Object.assign(Object.assign({},j.props),{expandTrigger:String,lineClamp:[Number,String],tooltip:{type:[Boolean,Object],default:!0}}),Ze=z({name:"Ellipsis",inheritAttrs:!1,props:Ye,slots:Object,setup(e,{slots:o,attrs:v}){const l=Be(),a=j("Ellipsis","-ellipsis",Je,Ge,e,l),h=k(null),g=k(null),d=k(null),n=k(!1),i=P(()=>{const{lineClamp:s}=e,{value:b}=n;return s!==void 0?{textOverflow:"","-webkit-line-clamp":b?"":s}:{textOverflow:b?"":"ellipsis","-webkit-line-clamp":""}});function c(){let s=!1;const{value:b}=n;if(b)return!0;const{value:m}=h;if(m){const{lineClamp:w}=e;if(u(m),w!==void 0)s=m.scrollHeight<=m.offsetHeight;else{const{value:L}=g;L&&(s=L.getBoundingClientRect().width<=m.getBoundingClientRect().width)}r(m,s)}return s}const p=P(()=>e.expandTrigger==="click"?()=>{var s;const{value:b}=n;b&&((s=d.value)===null||s===void 0||s.setShow(!1)),n.value=!b}:void 0);Re(()=>{var s;e.tooltip&&((s=d.value)===null||s===void 0||s.setShow(!1))});const f=()=>C("span",Object.assign({},Z(v,{class:[`${l.value}-ellipsis`,e.lineClamp!==void 0?U(l.value):void 0,e.expandTrigger==="click"?K(l.value,"pointer"):void 0],style:i.value}),{ref:"triggerRef",onClick:p.value,onMouseenter:e.expandTrigger==="click"?c:void 0}),e.lineClamp?o:C("span",{ref:"triggerInnerRef"},o));function u(s){if(!s)return;const b=i.value,m=U(l.value);e.lineClamp!==void 0?I(s,m,"add"):I(s,m,"remove");for(const w in b)s.style[w]!==b[w]&&(s.style[w]=b[w])}function r(s,b){const m=K(l.value,"pointer");e.expandTrigger==="click"&&!b?I(s,m,"add"):I(s,m,"remove")}function I(s,b,m){m==="add"?s.classList.contains(b)||s.classList.add(b):s.classList.contains(b)&&s.classList.remove(b)}return{mergedTheme:a,triggerRef:h,triggerInnerRef:g,tooltipRef:d,handleClick:p,renderTrigger:f,getTooltipDisabled:c}},render(){var e;const{tooltip:o,renderTrigger:v,$slots:l}=this;if(o){const{mergedTheme:a}=this;return C(Ee,Object.assign({ref:"tooltipRef",placement:"top"},o,{getDisabled:this.getTooltipDisabled,theme:a.peers.Tooltip,themeOverrides:a.peerOverrides.Tooltip}),{trigger:v,default:(e=l.tooltip)!==null&&e!==void 0?e:l.default})}else return v()}}),D=z({name:"Text",props:{text:{type:[String,Number],default:""},placeholder:{type:String,default:"-"}},setup(e){const{text:o,placeholder:v}=N(e),l=()=>{const a=String(o.value);return a||v.value};return()=>l()}}),Qe="_item_1fqoq_1",B={"book-details":"_book-details_1fqoq_1",item:Qe,"book-cover-image":"_book-cover-image_1fqoq_10"},Xe=z({name:"BookDetails",props:{bookData:{type:Object,default:()=>({})},locationIcon:{type:Object,default:()=>t(F,{name:"locationPin"},null)},onRateChange:{type:Function}},setup(e){const{bookData:o,locationIcon:v}=N(e),{t:l}=Q({useScope:"global"}),a=P(()=>{var g,d,n;const h=(d=(g=o.value)==null?void 0:g.covers)==null?void 0:d[0];return oe(h,(n=o.value)==null?void 0:n.title)});return()=>{var h,g,d,n,i,c,p,f,u;return t("div",{class:$(B["book-details"])},[t("h1",null,[(h=o.value)==null?void 0:h.title]),t("p",null,[(g=o.value)==null?void 0:g.isbn]),t("p",null,[l("pages.book.preview.detail.author"),M("："),O((d=o.value)==null?void 0:d.authors,l("pages.book.preview.detail.noAuthor"),B.item)]),t("p",null,[t(Le,{value:(n=o.value)==null?void 0:n.rating,allowHalf:!0,onUpdateValue:e.onRateChange,readonly:!0},null)]),t("p",null,[t(je,{class:$(B["book-cover-image"]),src:a.value,renderToolbar:({nodes:r})=>t(ze,null,[r.zoomIn,r.resizeToOriginalSize,r.zoomOut])},null)]),t("p",null,[t(Ke,{showIcon:!1,type:"info"},{default:()=>[t(W,{scope:"global",keypath:"pages.book.preview.detail.location"},{default:()=>[t(Ae,null,{default:()=>[v.value]})]})]})]),t("h3",null,[l("pages.book.preview.detail.details")]),t("p",null,[O((i=o.value)==null?void 0:i.publishers,l("pages.book.preview.detail.noPublisher"),B.item)]),t("p",null,[M("出版时间： "),t(D,{text:(c=o.value)==null?void 0:c.publishDate},null)]),t("p",null,[O((p=o.value)==null?void 0:p.languages,l("pages.book.preview.detail.noLanguage"),B.item)]),t("p",null,[t(W,{scope:"global",keypath:"pages.book.preview.detail.numberOfPages.text"},{default:()=>{var r;return[t(D,{text:(r=o.value)==null?void 0:r.numberOfPages,placeholder:l("pages.book.preview.detail.numberOfPages.placeholder")},null)]}})]),t("p",null,[O((f=o.value)==null?void 0:f.tags,l("pages.book.preview.detail.noTags"),B.item)]),t("p",null,[O((u=o.value)==null?void 0:u.subjects,l("pages.book.preview.detail.noSubject"),B.item)]),t("p",null,[t("h3",null,[l("pages.book.preview.detail.summary")]),t("div",null,[t(Ze,{expandTrigger:"click",lineClamp:5,tooltip:!1},{default:()=>{var r;return[t(D,{text:(r=o.value)==null?void 0:r.summary},null)]}})])])])}}}),eo="_flip_ay5yt_24",G={"duplicate-books-icon":"_duplicate-books-icon_ay5yt_1",flip:eo},oo=z({name:"DuplicateBooksIcon",props:{cover:{type:Blob},title:{type:String}},setup(e){const{cover:o,title:v}=N(e),l=P(()=>oe(o.value,v.value)),a=k(!1);return setTimeout(()=>{Pe(()=>{a.value=!0})},1e3),()=>t("div",{class:$(G["duplicate-books-icon"],{[G.flip]:a.value}),style:{"--background-image":`url(${l.value})`}},["⬜️"])}}),J={"book-location":"_book-location_1s333_1","preview-card":"_preview-card_1s333_7"},to=z({name:"BookLocation",props:{bookcaseIds:{type:Array,default:()=>[]}},setup(e){const{router:o}=ee(),v=k([]),l=k(!1),a=k([]),h=k(0);return X(v.value,g=>{if(g.filter(d=>d!==void 0).length===e.bookcaseIds.length){l.value=!0;const d=[],n=[0,0];for(let i=0;i<g.length;i++)n[0]<=n[1]?(d.push([0,n[0]]),n[0]+=g[i]):(d.push([1,n[1]]),n[1]+=g[i]);a.value=d,h.value=Math.max(...n)}}),()=>t("div",{class:$(J["book-location"]),style:{height:`${h.value+1}px`}},[e.bookcaseIds.map((g,d)=>{const n=a.value[d]||[0,0],i=n[0]===0?"0%":"100%",c=n[1]+"px";return t("div",{class:$(J["preview-card"]),style:{visibility:l.value?"visible":"hidden",transform:`translate(${i}, ${c})`},onClick:()=>{o.push(`/cell/${g.cellId}`)}},[t(Ne,{key:g.bookcaseId,bookcaseId:g.bookcaseId,selectedCellId:g.cellId,onSizeLoad:(p,f)=>{v.value[d]=f},isLocated:d===0},null)])})])}}),lo={"preview-book":"_preview-book_ozp5a_1"};function H(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!$e(e)}const go=z({name:"PreviewBook",setup(){const{t:e}=Q({useScope:"global"}),{route:o,router:v}=ee(),l=k(),a=k([]);X(()=>o.params,i=>{const{isbn:c,id:p}=i;p?q.book.queryRelatedBooksByBookId(p).then(f=>{if(f!=null&&f.length){const[u,...r]=f;l.value=u,a.value=r||[]}}):c&&q.book.queryFirstBookByIsbn(c).then(f=>{if(f!=null&&f.length){const[u,...r]=f;l.value=u,a.value=r||[]}})},{immediate:!0});const h=()=>{var i,c,p;return a.value.length?t(oo,{cover:(c=(i=l.value)==null?void 0:i.covers)==null?void 0:c[0],title:(p=l.value)==null?void 0:p.title},null):t(F,{name:"locationPin"},null)};function g(){var c;const i=(c=l.value)==null?void 0:c.id;i&&v.push({path:`/book/edit/id/${i}`,replace:!0})}const d=i=>{let c;return t("div",{class:$(lo["preview-book"])},[t(De,{topBar:t(V,{rightSlots:[t(A,{onClick:i},H(c=h())?c:{default:()=>[c]}),t(A,{onClick:g},{default:()=>[t(F,{name:"pencil"},null)]})]},{default:()=>{var p;return[((p=l.value)==null?void 0:p.title)||"-"]}})},{default:()=>[t(Xe,{bookData:l.value,locationIcon:h()},null)]})])},n=i=>{let c,p;const f=[l.value,...a.value].filter(u=>!!u).map(u=>({bookcaseId:u.bookcaseId,cellId:u.cellId}));return t(Fe,{topBar:t(V,{leftSlots:[t(A,{text:!0,onClick:i},H(c=e("common.close"))?c:{default:()=>[c]})]},H(p=e("pages.book.preview.decker.topbar.title"))?p:{default:()=>[p]})},{default:()=>[t(to,{bookcaseIds:f},null)]})};return()=>t(He,null,{default:d,decker:n})}});export{go as default};
//# sourceMappingURL=PreviewBook-DtI6qnj1.js.map
