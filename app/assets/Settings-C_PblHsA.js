import{d as C,u as D,a as B,c as e,e as o,f as g,aW as V,r as f,o as A,aX as I,F as N,aY as j,B as _,aZ as O,a_ as P,S as w,g as L,i as M}from"./index-Cni767JF.js";import{B as S,a as K}from"./BasicTopBar-CjiAK_wC.js";import{D as R,a as W}from"./DeckerLayout-D6Hb85Uw.js";import{d as X}from"./vue-utils-ChDqUZwr.js";import"./useTRouter-BbeS9Gm1.js";const Y="_settings_u1gk8_1",Z="_list_u1gk8_1",q="_catogory_u1gk8_6",z="_item_u1gk8_12",E="_label_u1gk8_23",G="_value_u1gk8_29",H="_control_u1gk8_38",l={settings:Y,list:Z,catogory:q,item:z,label:E,value:G,control:H},J=C({name:"ClearData",setup(){const{t:a}=D({useScope:"global"}),{dialog:n,message:d}=B();return()=>e("li",{class:o(l.item),onClick:()=>{n.warning({title:a("pages.settings.clearData.confirmDialog.title"),content:a("pages.settings.clearData.confirmDialog.content"),positiveText:a("common.yes"),negativeText:a("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([g.book.clearAllBooks(),g.bookcase.clearAllBookcases(),g.settings.clearAllSettings()]).then(()=>{d.success(a("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:o(l.label)},[a("pages.settings.clearData.label")]),e("span",{class:o(l.value)},null)])}});function b(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!M(a)}const ae=C({name:"Settings",setup(){const{updateSettingMap:a}=V(),{t:n}=D({useScope:"global"}),{message:d}=B(),p=f([]),r=f(),m=f(),k=()=>Promise.all(I.map(s=>g.settings.getSettingsByCategory(s))).then(s=>{p.value=s});A(()=>{k()});const y=s=>{const{key:c,value:i}=s;return g.settings.updateSettingValueByKey(c,i).then(()=>{d.success(n("pages.settings.decker.topbar.saveSuccess")),a(c,i)}).catch(()=>{d.error(n("pages.settings.decker.topbar.saveFailed")),k()})},h=s=>{let c,i;if(m.value===void 0||r.value===void 0)return s(),e(N,null,null);const t=m.value;return e(W,{topBar:e(S,{leftSlots:[e(_,{text:!0,onClick:s},b(c=n("common.cancel"))?c:{default:()=>[c]})],rightSlots:[e(_,{text:!0,type:"primary",onClick:()=>{const{key:u}=t,v=p.value[r.value],T=v.findIndex(F=>F.key===u);v.splice(T,1,t),p.value.splice(r.value,1,v),y(t).finally(()=>{m.value=void 0,r.value=void 0,s()})}},b(i=n("common.save"))?i:{default:()=>[i]})]},null)},{default:()=>[e("div",{class:l.control},[e("div",null,[n(t.label)]),j(t,u=>{t.value=u})])]})},x=s=>e(K,{topBar:e(S,null,{default:()=>[e(w,{name:"setting"},null),L(" "),n("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[n("pages.settings.topbar.title")]),e("ul",{class:o(l.list)},[p.value.map((c,i)=>e("div",{class:o(l.catogory)},[c.filter(t=>!t.hidden).map(t=>e("li",{key:t.key,class:o(l.item),onClick:()=>{O(t)&&(r.value=i,m.value=X(t),s())}},[e("span",{class:o(l.label)},[n(t.label)]),e("span",{class:o(l.value)},[P(t,u=>{t.value=u,y(t)})])]))])),e("div",{class:o(l.catogory)},[e(J,null,null)])])]});return()=>e(R,{class:o(l.settings)},{default:x,decker:h})}});export{ae as default};
//# sourceMappingURL=Settings-C_PblHsA.js.map
