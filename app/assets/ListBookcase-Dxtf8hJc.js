import{d as B,t as R,u as w,a as F,r as c,w as N,c as o,e as p,B as x,g as P,S as k,f as h,o as T,i as $,I as j}from"./index-B9OrxFfD.js";import{u as D}from"./useTRouter-CACSOkwj.js";import{B as E,a as M}from"./BasicTopBar-BhZyzsle.js";import{E as V}from"./Empty-Q5ndBnbD.js";import{D as O}from"./DeleteConfirmButton-mPLq3RV5.js";import{B as W}from"./BookcasePreview-D3Ayd_VB.js";import"./Popconfirm-YY74c16L.js";import"./Popover-DUPp_p1s.js";import"./get-CwQUj6A4.js";import"./constants-a1Lh4Cfi.js";const q="_waterfall_1mpvx_1",z="_mask_1mpvx_28",A="_shown_1mpvx_45",u={waterfall:q,"bookcase-waterfall-list":"_bookcase-waterfall-list_1mpvx_11","waterfall-item":"_waterfall-item_1mpvx_20",mask:z,shown:A},Y=B({name:"WaterfallList",props:{list:{type:Array,default:()=>[]},onReloadData:{type:Function}},setup(s){const{list:d}=R(s),{t:r}=w({useScope:"global"}),{router:f}=D(),{message:m}=F(),l=c(),i=c(!1),v=c(0),g=c([]),b=c([]);N(g.value,e=>{if(e.filter(t=>t!==void 0).length===d.value.length){i.value=!0;const t=[],a=[0,0];for(let n=0;n<e.length;n++)a[0]<=a[1]?(t.push([0,a[0]]),a[0]+=e[n]):(t.push([1,a[1]]),a[1]+=e[n]);b.value=t,v.value=Math.max(...a)}},{immediate:!0});const L=e=>{var n;e.stopPropagation();const t=e.target,a=(n=t==null?void 0:t.dataset)==null?void 0:n.id;a!==void 0?l.value=a:l.value=void 0},S=e=>{e&&h.book.queryBookByBookcaseId(e).then(t=>{t!=null&&t.length?m.error(r("pages.bookcase.list.waterfallList.cannotDelete.message")):h.bookcase.deleteBookcase(e).then(()=>{var a;(a=s.onReloadData)==null||a.call(s),l.value=void 0})})};return()=>o("div",{class:p(u.waterfall),onClick:()=>{l.value=void 0}},[o("ul",{class:p(u["bookcase-waterfall-list"]),style:{height:`${v.value+1}px`},onClick:L},[d.value.map((e,t)=>{const a=b.value[t]||[0,(Math.random()-.5)*1e3],n=a[0]===0?"0%":"100%",C=a[1]+"px";return o("li",{key:e.id,class:p(u["waterfall-item"]),style:{visibility:i.value?"visible":"hidden",transform:`translate(${n}, ${C})`},"data-id":e.id},[o("div",{class:p(u.mask,{[u.shown]:l.value===e.id})},[o(x,{circle:!0,onClick:()=>{f.push({path:`/bookcase/edit/${e.id}`})}},{default:()=>[P("ðŸ‘€ï¸")]}),o(O,{circle:!0,onShow:_=>{_.stopPropagation()},onConfirm:()=>S(e.id)},{default:()=>[o(k,{name:"delete"},null)]})]),o(W,{bookcaseId:e.id,onSizeLoad:(_,I)=>{g.value[t]=I}},null)])})])])}});function y(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!$(s)}const ae=B({name:"ListBookcase",setup(){const{t:s}=w({useScope:"global"}),{router:d}=D(),r=c([]);function f(){h.bookcase.getBookcases().then(l=>{r.value=l})}T(()=>{f()});const m=()=>r.value.length===0?o(V,{title:s("pages.bookcase.list.empty.title"),description:o(j,{scope:"global",keypath:"pages.bookcase.list.empty.description"},{default:()=>[o(k,{name:"plus"},null)]})},null):o(Y,{list:r.value,onReloadData:f},null);return()=>{let l,i;return o(M,{topBar:o(E,{rightSlots:[o(x,{onClick:()=>{d.push({path:"/bookcase/new"})}},{default:()=>[o(k,{name:"plus"},null)]})]},y(l=s("pages.bookcase.list.topbar.title"))?l:{default:()=>[l]})},y(i=m())?i:{default:()=>[i]})}}});export{ae as default};
//# sourceMappingURL=ListBookcase-Dxtf8hJc.js.map
