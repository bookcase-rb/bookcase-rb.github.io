import{d as v,u as _,a as y,c as e,e as n,f as g,aY as F,aZ as V,r as f,o as I,a_ as N,F as P,a$ as j,B as k,b0 as w,b1 as O,S as R,g as L,i as M}from"./index-CNTf6xRC.js";import{B as D,a as K}from"./BasicTopBar-DJ5S0ikE.js";import{D as Y,a as Z}from"./DeckerLayout-DA21rS_8.js";import{d as $}from"./vue-utils-CRlvljjR.js";import"./useTRouter-CEpp3g6Z.js";const q="_settings_1gbcb_1",z="_list_1gbcb_1",E="_catogory_1gbcb_6",G="_item_1gbcb_12",H="_label_1gbcb_23",J="_danger_1gbcb_30",Q="_value_1gbcb_33",U="_control_1gbcb_42",a={settings:q,list:z,catogory:E,item:G,label:H,danger:J,value:Q,control:U},W=v({name:"ClearData",setup(){const{t}=_({useScope:"global"}),{dialog:l,message:u}=y();return()=>e("li",{class:n(a.item),onClick:()=>{l.warning({title:t("pages.settings.clearData.confirmDialog.title"),content:t("pages.settings.clearData.confirmDialog.content"),positiveText:t("common.yes"),negativeText:t("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([g.book.clearAllBooks(),g.bookcase.clearAllBookcases(),g.settings.clearAllSettings()]).then(()=>{u.success(t("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:n(a.label,a.danger)},[t("pages.settings.clearData.label")]),e("span",{class:n(a.value)},null)])}}),X=v({name:"ResetConfig",setup(){const{t}=_({useScope:"global"}),{dialog:l,message:u}=y();return()=>e("li",{class:n(a.item),onClick:()=>{l.warning({title:t("pages.settings.resetConfig.confirmDialog.title"),content:t("pages.settings.resetConfig.confirmDialog.content"),positiveText:t("common.yes"),negativeText:t("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){g.settings.clearAllSettings().then(()=>{const d=F.map((r,p)=>({...r,index:p}));return g.settings.batchCreateSettings(d)}).then(()=>{u.success(t("pages.settings.resetConfig.confirmDialog.resetFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:n(a.label,a.danger)},[t("pages.settings.resetConfig.label")]),e("span",{class:n(a.value)},null)])}});function h(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!M(t)}const le=v({name:"Settings",setup(){const{updateSettingMap:t}=V(),{t:l}=_({useScope:"global"}),{message:u}=y(),d=f([]),r=f(),p=f(),S=()=>Promise.all(N.map(o=>g.settings.getSettingsByCategory(o))).then(o=>{d.value=o});I(()=>{S()});const C=o=>{const{key:i,value:c}=o;return g.settings.updateSettingValueByKey(i,c).then(()=>{u.success(l("pages.settings.decker.topbar.saveSuccess")),t(i,c)}).catch(()=>{u.error(l("pages.settings.decker.topbar.saveFailed")),S()})},B=o=>{let i,c;if(p.value===void 0||r.value===void 0)return o(),e(P,null,null);const s=p.value;return e(Z,{topBar:e(D,{leftSlots:[e(k,{text:!0,onClick:o},h(i=l("common.cancel"))?i:{default:()=>[i]})],rightSlots:[e(k,{text:!0,type:"primary",onClick:()=>{const{key:m}=s,b=d.value[r.value],T=b.findIndex(A=>A.key===m);b.splice(T,1,s),d.value.splice(r.value,1,b),C(s).finally(()=>{p.value=void 0,r.value=void 0,o()})}},h(c=l("common.save"))?c:{default:()=>[c]})]},null)},{default:()=>[e("div",{class:a.control},[e("div",null,[l(s.label)]),j(s,m=>{s.value=m})])]})},x=o=>e(K,{topBar:e(D,null,{default:()=>[e(R,{name:"setting"},null),L(" "),l("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[l("pages.settings.topbar.title")]),e("ul",{class:n(a.list)},[d.value.map((i,c)=>e("div",{class:n(a.catogory)},[i.filter(s=>!s.hidden).map(s=>e("li",{key:s.key,class:n(a.item),onClick:()=>{w(s)&&(r.value=c,p.value=$(s),o())}},[e("span",{class:n(a.label)},[l(s.label)]),e("span",{class:n(a.value)},[O(s,m=>{s.value=m,C(s)})])]))])),e("div",{class:n(a.catogory)},[e(X,null,null),e(W,null,null)])])]});return()=>e(Y,{class:n(a.settings)},{default:x,decker:B})}});export{le as default};
//# sourceMappingURL=Settings-DUfNRGzA.js.map
