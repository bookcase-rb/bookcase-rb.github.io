import{d as w,u as B,a as y,r as c,w as h,b as S,c as a,B as I,S as F,e as N,i as _,an as j,ao as A,f as C}from"./index-n8WRPimo.js";import{B as D,s as E}from"./index-B5Q1wP7V.js";import{a as R,B as q}from"./BasicTopBar-DKU1SHVf.js";import{s as O}from"./utils-Dk8xp9Lt.js";import"./vue-utils-BQQw-n6I.js";import"./InputGroup-iLiw0CNU.js";import"./Popover-qF0i0i3l.js";import"./get-Cba6XoKv.js";import"./Image-BU4h6QCP.js";import"./create-D3Vn69pI.js";import"./FormItem-CEFm5rct.js";import"./InputNumber-GEPqGMGU.js";import"./useTRouter-CzE_LlLf.js";const V={"new-book":"_new-book_zpv31_1"};function x(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!_(r)}const X=w({name:"NewBook",setup(){const{t:r}=B({useScope:"global"}),l=j(),b=A(),{message:i}=y(),u=c(),s=c();function k(){var t;const{cellId:o,bookcaseId:e}=l.query;(t=u.value)==null||t.getFormData().then(d=>{console.log(d);const f=d;if(f){if(typeof o!="string"||typeof e!="string")throw new Error("cellId and bookcaseId invalid");C.book.addBook(f,o,e).then(g=>{const{id:v}=g;b.replace({path:`/book/preview/id/${v}`})})}})}const p=new AbortController,n=c(!1);function m(o){n.value=!0;const e=p.signal;return E(o,e).catch(t=>{throw t.name!=="AbortError"&&i.error(...O()),t}).finally(()=>{n.value=!1})}return h(()=>l.query,o=>{const e=o.isbn;e&&m(e).then(t=>{s.value={...t}}).catch(()=>{s.value={isbn:e}})},{immediate:!0}),S(()=>{i.destroyAll(),p.abort()}),()=>{let o;return a("div",{class:N(V["new-book"])},[a(R,{loading:n.value,topBar:a(q,{rightSlots:[a(I,{onClick:k},{default:()=>[a(F,{name:"save"},null)]})]},x(o=r("pages.book.new.topbar.title"))?o:{default:()=>[o]})},{default:()=>[a(D,{ref:u,scraping:n.value,data:s.value,onScrape:m},null)]})])}}});export{X as default};
//# sourceMappingURL=NewBook-sXQfiWB0.js.map
