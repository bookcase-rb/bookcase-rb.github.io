import{d as h,u as C,a as d,r as c,w as S,b as w,c as a,B as A,S as p,f as i,e as F,aA as I}from"./index-B3qSu1dX.js";import{u as E}from"./useTRouter-D4zg8088.js";import{B as P,s as T}from"./index-BehpEYse.js";import{a as x,B as N}from"./BasicTopBar-pM3hxXIp.js";import{D as q}from"./DeleteConfirmButton-ogdrf5qP.js";import{D as R}from"./DeckerLayout-BGm3u6Rp.js";import{B as _}from"./BarcodeDecker-Dq0tpjgC.js";import"./vue-utils-BhyqPCEr.js";import"./InputGroup-C_qMsqu0.js";import"./Popover-Dpij0fg9.js";import"./get-DrtZLwal.js";import"./Image-b7Kh8lJS.js";import"./create-D3Vn69pI.js";import"./FormItem-CDLaxtsf.js";import"./Rate-D_2cp1hO.js";import"./InputNumber-Dutkkz1c.js";import"./Popconfirm-m6vKgCnE.js";const j={"edit-book":"_edit-book_166qk_1"},oe=h({name:"EditBook",setup(){const{t:r}=C({useScope:"global"}),{route:f,router:k}=E(),{message:l}=d(),{dialog:B}=d(),u=c(),n=c(),s=c(!1),v=e=>{s.value=!0,i.book.queryBookByBookId(e).then(o=>{o&&(n.value=o)}).finally(()=>{s.value=!1})},m=new AbortController;function b(e){s.value=!0;const o=m.signal;return(e?Promise.resolve(e):Promise.reject()).then(t=>T(t,o)).catch(t=>{throw t.name!=="AbortError"&&l.error(...I()),t}).finally(()=>{s.value=!1})}S(()=>f.params.bookId,e=>{Array.isArray(e)||v(e)},{immediate:!0});function g(){var e;(e=u.value)==null||e.getFormData().then(o=>{const t=o;i.book.updateBook(t).then(()=>{l.success(r("pages.book.edit.saveSuccess"))})})}w(()=>{l.destroyAll(),m.abort()});const D=e=>a("div",{class:F(j["edit-book"])},[a(x,{loading:s.value,topBar:a(N,{rightSlots:[a(A,{onClick:g},{default:()=>[a(p,{name:"save"},null)]}),a(q,{onConfirm:()=>{var t;const o=(t=n.value)==null?void 0:t.id;o&&i.book.deleteBook(o).then(()=>{l.success(r("pages.book.edit.deleteSuccess")),k.back()})}},{default:()=>[a(p,{name:"delete"},null)]})]},{default:()=>{var o;return[((o=n.value)==null?void 0:o.title)||"-"]}})},{default:()=>[a(P,{ref:u,scraping:s.value,data:n.value,onScan:e,onScrape:b},null)]})]),y=e=>a(_,{onBarcodeDetect:o=>new Promise(t=>{B.success({title:r("pages.cell.newBarcodeDialog.title"),content:r("pages.cell.newBarcodeDialog.content",[o]),closable:!1,positiveText:r("common.yes"),negativeText:r("common.no"),onPositiveClick:()=>{n.value={isbn:o},e(),t(!0)},onNegativeClick:()=>{t(!1)}})}),onClose:e},null);return()=>a(R,null,{default:e=>D(e),decker:e=>y(e)})}});export{oe as default};
//# sourceMappingURL=EditBook-B8Cu7f1_.js.map
