import{u as x}from"./useTRouter-DP--qWrD.js";import{d as E,u as L,a as R,r as i,w as T,c as t,S as d,B as q,e as P,N as _,j as $,I as j,f as p}from"./index-DG1BSOqx.js";import{a as A,B as V}from"./BasicTopBar-DuZzNMww.js";import{D as F}from"./DeckerLayout-BZZOZaR9.js";import{B as K}from"./BookList-d0gCqb-E.js";import{E as B}from"./Empty-C5QrnUIT.js";import{B as M}from"./BarcodeDecker-DUUmbtUn.js";import{N as U}from"./Dropdown-DcelgOM4.js";import"./utils-BWEJTcwZ.js";import"./Rate-rQNExyl6.js";import"./Popconfirm-C716FB8M.js";import"./Popover-pV-BjsIs.js";import"./get-C1tFBBB5.js";import"./create-D3Vn69pI.js";const z="_cell_ut9cg_1",G={cell:z},se=E({name:"Cell",setup(){const{t:l}=L({useScope:"global"}),{route:b,router:m}=x(),{dialog:h}=R(),k=i(),f=i(),c=i([]);T(()=>b.params,o=>{const e=o.cellId;p.bookcase.queryCellInfo(e).then(a=>{f.value=a,p.bookcase.queryBookcaseById(a==null?void 0:a.bookcaseId).then(n=>{k.value=n})}),p.book.queryBooksByCellId(e).then(a=>{c.value=a,g()})},{immediate:!0});const v=o=>{if(!f.value)return;const{id:e,bookcaseId:a}=f.value;m.push({path:"/book/new",query:{isbn:o||"",bookcaseId:a,cellId:e}})},y=o=>new Promise(e=>{h.success({title:l("pages.cell.newBarcodeDialog.title"),content:l("pages.cell.newBarcodeDialog.content",[o]),closable:!1,positiveText:l("common.yes"),negativeText:l("common.no"),onPositiveClick:()=>{v(o),e(!0)},onNegativeClick:()=>{e(!1)}})}),I=()=>{v()},s=i(""),r=i([]),g=()=>{s.value===""&&(r.value=c.value);const o=$(s.value).split(" ").map(n=>n.trim()).filter(n=>!!n),e=new RegExp(`${o.join("|")}`),a=c.value.filter(n=>{let u=!1;const{title:S,authors:C,isbn:D}=n;return u||(u=e.test(S)),u||(u=C.some(N=>e.test(N))),u||(u=e.test(D)),u});r.value=a},w=()=>c.value.length===0?t(B,{title:l("pages.cell.empty.title"),description:t(j,{scope:"global",keypath:"pages.cell.empty.description"},{default:()=>[t(d,{name:"plus"},null)]})},null):r.value.length===0?t(B,{title:l("pages.cell.noResult.title"),description:l("pages.cell.noResult.description")},null):t("div",{style:{flex:1,overflow:"hidden"}},[t(K,{data:r.value,onPreviewBook:o=>{m.push({path:`/book/preview/id/${o.id}`})},onEditBook:o=>{m.push({path:`/book/edit/id/${o.id}`})},onDeleteBook:o=>{p.book.deleteBook(o.id).then(()=>{r.value=r.value.filter(e=>e.id!==o.id)})}},null)]);return()=>t(F,null,{default:o=>t(A,{topBar:t(V,{rightSlots:[t(U,{trigger:"click",placement:"bottom-end",options:[{key:"barcodeScan",label:l("pages.cell.topBar.rightSlots.barcodeScan"),icon:()=>t(d,{name:"barcodeScan"},null)},{key:"manual",label:l("pages.cell.topBar.rightSlots.manual"),icon:()=>t(d,{name:"memo"},null)}],onSelect:e=>{e==="barcodeScan"?o():e==="manual"&&I()}},{default:()=>[t(q,null,{default:()=>[t(d,{name:"plus"},null)]})]})]},{default:()=>{var e;return[(e=k.value)==null?void 0:e.name]}})},{default:()=>[t("div",{class:P(G.cell)},[t(_,{placeholder:l("pages.cell.search.placeholder"),disabled:c.value.length===0,value:s.value,onUpdateValue:e=>{s.value=e},onKeyup:e=>{e.key==="Enter"&&(s.value=s.value.trim(),g())}},null),w()])]}),decker:o=>t(M,{onBarcodeDetect:y,onClose:o},null)})}});export{se as default};
//# sourceMappingURL=Cell-USjsHln4.js.map
