import{d as A,u as C,a as k,r as d,w as I,b as N,c as n,ay as F,az as _,B as g,S as w,e as q,i as E,aA as T,aB as j,f as x}from"./index-DG1BSOqx.js";import{B as R,s as z}from"./index-CRbVmd0U.js";import{a as O,B as P}from"./BasicTopBar-DuZzNMww.js";import{D as V}from"./DeckerLayout-BZZOZaR9.js";import{B as L}from"./BarcodeDecker-DUUmbtUn.js";import"./vue-utils-CT_KUi70.js";import"./InputGroup-C-zfs_V6.js";import"./Popover-pV-BjsIs.js";import"./get-C1tFBBB5.js";import"./Image-CafND0yQ.js";import"./create-D3Vn69pI.js";import"./FormItem-qM9ySIGc.js";import"./Rate-rQNExyl6.js";import"./InputNumber-Cv6rJ1SC.js";import"./useTRouter-DP--qWrD.js";const M={"new-book":"_new-book_zpv31_1"};function U(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!E(a)}const re=A({name:"NewBook",setup(){const{t:a}=C({useScope:"global"}),l=F(),p=_(),{message:c}=k(),{dialog:B}=k(),i=d(),r=d();function m(){var t;const{cellId:e,bookcaseId:o}=l.query;return(t=i.value)==null?void 0:t.getFormData().then(u=>{const v=u;if(!v)throw new Error("book form data invalid");if(typeof e!="string"||typeof o!="string")throw new Error("cellId and bookcaseId invalid");return x.book.addBook(v,e,o)})}function y(){m().then(e=>{const{id:o}=e;p.replace({path:`/book/preview/id/${o}`})})}function h(){m().then(()=>{c.success(a("pages.book.new.saveAndAdd.saveSuccess")),p.replace({path:"/book/new",query:{...l.query,isbn:"",t:new Date().getTime()}})})}const f=new AbortController,s=d(!1);function b(e){s.value=!0;const o=f.signal;return z(e,o).catch(t=>{throw t.name!=="AbortError"&&c.error(...T()),t}).finally(()=>{s.value=!1})}I(()=>l.query,e=>{var t;const o=e.isbn;o?b(o).then(u=>{r.value={...u}}).catch(()=>{r.value={isbn:o}}):(r.value={...j},(t=i.value)==null||t.reset())},{immediate:!0}),N(()=>{c.destroyAll(),f.abort()});const D=e=>{let o;return n("div",{class:q(M["new-book"])},[n(O,{loading:s.value,topBar:n(P,{rightSlots:[n(g,{onClick:y},{default:()=>[n(w,{name:"save"},null)]}),n(g,{onClick:h},{default:()=>[n(w,{name:"save-and-plus"},null)]})]},U(o=a("pages.book.new.topbar.title"))?o:{default:()=>[o]})},{default:()=>[n(R,{ref:i,scraping:s.value,data:r.value,onScan:e,onScrape:b},null)]})])},S=e=>n(L,{onBarcodeDetect:o=>new Promise(t=>{B.success({title:a("pages.cell.newBarcodeDialog.title"),content:a("pages.cell.newBarcodeDialog.content",[o]),closable:!1,positiveText:a("common.yes"),negativeText:a("common.no"),onPositiveClick:()=>{r.value={isbn:o},e(),t(!0)},onNegativeClick:()=>{t(!1)}})}),onClose:e},null);return()=>n(V,null,{default:e=>D(e),decker:e=>S(e)})}});export{re as default};
//# sourceMappingURL=NewBook-DBqwdZc5.js.map
